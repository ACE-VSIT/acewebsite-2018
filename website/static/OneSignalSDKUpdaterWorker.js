!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=73)}([function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(47),a=n(38),u=n(3),c=n(14),l=n(18),d=o(n(7)),f=n(13),p=function(){function e(){}return e.getBuildEnv=function(){return s.BuildEnvironmentKind.Production},e.getIntegration=function(t){return r(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){switch(i.label){case 0:if(d.default.safari)return[2,l.IntegrationKind.Secure];if(n=window===window.top,r="https:"===window.location.protocol,void 0===t){if("undefined"==typeof OneSignal)throw new c.InvalidArgumentError("usingProxyOrigin",c.InvalidArgumentReason.Empty);(o=OneSignal.context)&&(t=!!o.appConfig.subdomain)}return n?r?[2,t?l.IntegrationKind.SecureProxy:l.IntegrationKind.Secure]:[2,l.IntegrationKind.InsecureProxy]:[3,1];case 1:return r?[4,e.isFrameContextInsecure()]:[3,3];case 2:return i.sent()?[2,l.IntegrationKind.InsecureProxy]:[2,t?l.IntegrationKind.SecureProxy:l.IntegrationKind.Secure];case 3:return[2,l.IntegrationKind.InsecureProxy];case 4:return[2]}})})},e.isFrameContextInsecure=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return window!==window.top&&"serviceWorker"in navigator&&void 0!==navigator.serviceWorker.getRegistration?[4,f.ServiceWorkerManager.getRegistration()]:[2,!1];case 1:return[2,!e.sent()]}})})},e.isInsecureOrigin=function(){return"http:"===window.location.protocol},e.getWindowEnv=function(){return"undefined"==typeof window?"undefined"!=typeof self&&void 0!==self.registration?u.WindowEnvironmentKind.ServiceWorker:u.WindowEnvironmentKind.Unknown:window===window.top?-1!==location.href.indexOf("initOneSignal")||"/subscribe"===location.pathname&&""===location.search&&(location.hostname.endsWith(".onesignal.com")||location.hostname.endsWith(".os.tc")||-1!==location.hostname.indexOf(".localhost")&&e.getBuildEnv()===s.BuildEnvironmentKind.Development)?u.WindowEnvironmentKind.OneSignalSubscriptionPopup:u.WindowEnvironmentKind.Host:"/webPushIframe"===location.pathname?u.WindowEnvironmentKind.OneSignalProxyFrame:"/webPushModal"===location.pathname?u.WindowEnvironmentKind.OneSignalSubscriptionModal:u.WindowEnvironmentKind.CustomIframe},e.getTestEnv=function(){return a.TestEnvironmentKind.None},e.getBuildEnvPrefix=function(t){switch(void 0===t&&(t=e.getBuildEnv()),t){case s.BuildEnvironmentKind.Development:return"Dev-";case s.BuildEnvironmentKind.Staging:return"Staging-";case s.BuildEnvironmentKind.Production:return"";default:throw new c.InvalidArgumentError("buildEnv",c.InvalidArgumentReason.EnumOutOfRange)}},e.getOneSignalApiUrl=function(t){switch(void 0===t&&(t=e.getBuildEnv()),t){case s.BuildEnvironmentKind.Development:return new URL("https://localhost:3001/api/v1");case s.BuildEnvironmentKind.Staging:return new URL("https://staging-01.onesignal.com/api/v1");case s.BuildEnvironmentKind.Production:return new URL("https://onesignal.com/api/v1");default:throw new c.InvalidArgumentError("buildEnv",c.InvalidArgumentReason.EnumOutOfRange)}},e.getOneSignalResourceUrlPath=function(t){void 0===t&&(t=e.getBuildEnv());var n,r=e.getOneSignalApiUrl(t).origin;switch(t){case s.BuildEnvironmentKind.Development:case s.BuildEnvironmentKind.Staging:case s.BuildEnvironmentKind.Production:n="/sdks";break;default:throw new c.InvalidArgumentError("buildEnv",c.InvalidArgumentReason.EnumOutOfRange)}return new URL(r+n)},e.getOneSignalCssFileName=function(t){void 0===t&&(t=e.getBuildEnv());switch(t){case s.BuildEnvironmentKind.Development:return"Dev-OneSignalSDKStyles.css";case s.BuildEnvironmentKind.Staging:return"Staging-OneSignalSDKStyles.css";case s.BuildEnvironmentKind.Production:return"OneSignalSDKStyles.css";default:throw new c.InvalidArgumentError("buildEnv",c.InvalidArgumentReason.EnumOutOfRange)}},e}();t.default=p},function(e,t,n){"use strict";(function(e){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(7)),a=o(n(5)),u=o(n(64)),c=o(n(0)),l=n(3),d=o(n(8)),f=o(n(2)),p=o(n(6));function h(e){return"[object Array]"===Object.prototype.toString.call(e)}t.isArray=h;var g=null;function v(){if(""===s.default.name&&""===s.default.version)var e=s.default._detect(navigator.userAgent);else e=s.default;return e}function b(){return OneSignal.config&&OneSignal.config.userConfig&&!0===OneSignal.config.userConfig.allowLocalhostAsSecureOrigin}function m(){if(!OneSignal.config)throw new Error("("+c.default.getWindowEnv().toString()+") isUsingSubscriptionWorkaround() cannot be called until OneSignal.config exists.");return!s.default.safari&&(!(b()&&"localhost"===location.hostname||"127.0.0.1"===location.hostname)&&!(c.default.getWindowEnv()!==l.WindowEnvironmentKind.Host&&c.default.getWindowEnv()!==l.WindowEnvironmentKind.CustomIframe||!OneSignal.config.subdomain&&"http:"!==location.protocol))}function w(e){return JSON.stringify(e,function(e,t){return"function"==typeof t?"[Function]":t},4)}function S(e){return"code"==e?'padding: 0 1px 1px 5px;border: 1px solid #ddd;border-radius: 3px;font-family: Monaco,"DejaVu Sans Mono","Courier New",monospace;color: #444;':"bold"==e?"font-weight: 600;color: rgb(51, 51, 51);":"alert"==e?"font-weight: 600;color: red;":"event"==e?"color: green;":"postmessage"==e?"color: orange;":"serviceworkermessage"==e?"color: purple;":""}function y(){return Promise.resolve()}function k(){return f.default.warn("OneSignal: Unsubscribing from push."),c.default.getWindowEnv()!==l.WindowEnvironmentKind.ServiceWorker?self.registration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe();throw new Error("Cannot unsubscribe because not subscribed.")}):m()?new Promise(function(e,t){f.default.debug("Unsubscribe from push got called, and we're going to remotely execute it in HTTPS iFrame."),OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_FROM_PUSH,null,function(n){f.default.debug("Unsubscribe from push succesfully remotely executed."),n.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?e():t("Failed to remotely unsubscribe from push.")})}):navigator.serviceWorker&&navigator.serviceWorker.controller?navigator.serviceWorker.ready.then(function(e){return e.pushManager}).then(function(e){return e.getSubscription()}).then(function(e){return e?e.unsubscribe():Promise.resolve()}):Promise.resolve()}function P(){return f.default.warn("OneSignal: Unregistering service worker."),c.default.getWindowEnv()===l.WindowEnvironmentKind.OneSignalProxyFrame?Promise.resolve():navigator.serviceWorker&&navigator.serviceWorker.controller?navigator.serviceWorker.ready.then(function(e){return e.unregister()}):Promise.resolve()}function _(){return window.__oneSignalSdkLoadCount||0}t.decodeHtmlEntities=function(e){return a.default.isBrowser()&&(g||(g=document.createElement("textarea"))),g?(g.innerHTML=e,g.value):e},t.redetectBrowserUserAgent=v,t.isPushNotificationsSupported=function(){if(void 0===window.Promise)return!1;var e=v(),t=navigator.userAgent||"";return!(!e.safari&&void 0===navigator.serviceWorker||e.ios||e.ipod||e.iphone||e.ipad||e.msie||!(e.msedge&&Number(e.version)>=17.17063)&&(t.indexOf("FBAN")>-1||t.indexOf("FBAV")>-1||navigator.appVersion.match(/ wv/)||e.firefox&&Number(e.version)<48&&(e.mobile||e.tablet)||!(e.firefox&&Number(e.version)>=44)&&!(e.safari&&Number(e.version)>=7.1)&&!(e.samsungBrowser&&Number(e.version)>=4)&&!((e.chrome||e.chromium)&&Number(e.version)>=42)&&!(e.yandexbrowser&&Number(e.version)>=15.12)&&!(e.opera&&(e.mobile||e.tablet)&&Number(e.version)>=37||e.opera&&Number(e.version)>=42)&&!e.vivaldi))},t.isChromeLikeBrowser=function(){return s.default.chrome||s.default.chromium||s.default.opera||s.default.yandexbrowser},t.removeDomElement=function(e){var t=document.querySelectorAll(e);if(t.length>0)for(var n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n])},t.isLocalhostAllowedAsSecureOrigin=b,t.awaitOneSignalInitAndSupported=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,new Promise(function(e){OneSignal.initialized?e():OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,e)})]})})},t.isUsingSubscriptionWorkaround=m,t.triggerNotificationPermissionChanged=function(e){return void 0===e&&(e=!1),r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return[4,OneSignal.privateGetNotificationPermission()];case 1:return n=i.sent(),[4,d.default.get("Options","notificationPermission")];case 2:return r=i.sent(),t=n,n!==r||e?[4,d.default.put("Options",{key:"notificationPermission",value:n})]:[3,4];case 3:i.sent(),p.default.trigger(OneSignal.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED,{to:t}),i.label=4;case 4:return[2]}})})},t.stringify=w,t.executeCallback=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e)return e.apply(null,t)},t.logMethodCall=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return f.default.debug("Called %c"+e+"("+t.map(w).join(", ")+")",S("code"),".")},t.isValidEmail=function(e){return!!e&&!!e.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/)},t.addDomElement=function(e,t,n){if("string"==typeof e)document.querySelector(e).insertAdjacentHTML(t,n);else{if("object"!=typeof e)throw new Error(e+" must be a CSS selector string or DOM Element object.");e.insertAdjacentHTML(t,n)}},t.clearDomElementChildren=function(e){if("string"==typeof e){var t=document.querySelector(e);if(null===t)throw new Error('Cannot find element with selector "'+e+'"');for(;t.firstChild;)t.removeChild(t.firstChild)}else{if("object"!=typeof e)throw new Error(e+" must be a CSS selector string or DOM Element object.");for(;e.firstChild;)e.removeChild(e.firstChild)}},t.addCssClass=function(e,t){if("string"==typeof e){var n=document.querySelector(e);if(null===n)throw new Error('Cannot find element with selector "'+e+'"');n.classList.add(t)}else{if("object"!=typeof e)throw new Error(e+" must be a CSS selector string or DOM Element object.");e.classList.add(t)}},t.removeCssClass=function(e,t){if("string"==typeof e){var n=document.querySelector(e);if(null===n)throw new Error('Cannot find element with selector "'+e+'"');n.classList.remove(t)}else{if("object"!=typeof e)throw new Error(e+" must be a CSS selector string or DOM Element object.");e.classList.remove(t)}},t.hasCssClass=function(e,t){if("string"==typeof e){var n=document.querySelector(e);if(null===n)throw new Error('Cannot find element with selector "'+e+'"');return n.classList.contains(t)}if("object"==typeof e)return e.classList.contains(t);throw new Error(e+" must be a CSS selector string or DOM Element object.")},t.getConsoleStyle=S,t.delay=function(e){return new Promise(function(t){setTimeout(t,e)})},t.nothing=y,t.timeoutPromise=function(e,t){var n=new Promise(function(e,n){setTimeout(function(){n(new u.default)},t)});return Promise.race([e,n])},t.when=function(e,t,n){return void 0===t&&(t=y()),void 0===n&&(n=y()),e?t:n},t.contains=function(e,t){return!!e&&-1!==e.indexOf(t)},t.trimUndefined=function(e){for(var t in e)e.hasOwnProperty(t)&&void 0===e[t]&&delete e[t];return e},t.getRandomUuid=function(){var t="undefined"==typeof window?e.crypto:window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t?function(e){var n=t.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"==e?n:3&n|8).toString(16)}:function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},t.isValidUuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)},t.getUrlQueryParam=function(e){var t=window.location.href;t=t.toLowerCase(),e=e.replace(/[\[\]]/g,"\\$&").toLowerCase();var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},t.wipeIndexedDb=function(){return f.default.warn("OneSignal: Wiping IndexedDB data."),Promise.all([d.default.remove("Ids"),d.default.remove("NotificationOpened"),d.default.remove("Options")])},t.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.unsubscribeFromPush=k,t.wipeServiceWorker=P,t.wipeServiceWorkerAndUnsubscribe=function(){return Promise.all([k(),P()])},t.wait=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.substringAfter=function(e,t){return e.substr(e.indexOf(t)+t.length)},t.once=function e(t,n,r,i){if(void 0===i&&(i=!1),n||f.default.error("Cannot call on() with no event: ",n),r||f.default.error("Cannot call on() with no task: ",r),"string"==typeof t){var o=document.querySelectorAll(t);if(o.length>0)for(var s=0;s<o.length;s++)e(o[s],n,r)}else if(h(t))for(s=0;s<t.length;s++)e(t[s],n,r);else{if("object"!=typeof t)throw new Error(t+" must be a CSS selector string or DOM Element object.");var a=function(e){var n=function(){t.removeEventListener(e.type,a)};i||n(),r(e,n)};t.addEventListener(n,a)}},t.getSdkLoadCount=_,t.awaitSdkEvent=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n){OneSignal.emitter.once(e,function(e){t?t(e)&&n(e):n(e)})})];case 1:return[2,n.sent()]}})})},t.incrementSdkLoadCount=function(){window.__oneSignalSdkLoadCount=_()+1},t.prepareEmailForHashing=function(e){return e.replace(/\s/g,"").toLowerCase()},t.encodeHashAsUriComponent=function(e){for(var t="",n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i];t+=encodeURIComponent(i)+"="+encodeURIComponent(o)}return t}}).call(this,n(36))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.shouldLog=function(){if("undefined"==typeof window||void 0===window.localStorage)return!1;try{var e=window.localStorage.getItem("loglevel");return!(!e||"trace"!==e.toLowerCase())}catch(e){return!1}},e.setLevel=function(t){if("undefined"!=typeof window&&void 0!==window.localStorage)try{window.localStorage.setItem("loglevel",t),e.proxyMethodsCreated=void 0,e.createProxyMethods()}catch(e){return}},e.createProxyMethods=function(){if(void 0===e.proxyMethodsCreated){e.proxyMethodsCreated=!0;for(var t={log:"debug",trace:"trace",info:"info",warn:"warn",error:"error"},n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],o=void 0!==console[i],s=t[i],a=o&&(e.shouldLog()||"error"===s);e[s]=a?console[i].bind(console):function(){}}}},e}();t.default=r,r.createProxyMethods()},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.WindowEnvironmentKind||(t.WindowEnvironmentKind={})).ServiceWorker="ServiceWorker",r.Host="Host",r.OneSignalSubscriptionPopup="Popup",r.OneSignalSubscriptionModal="Modal",r.OneSignalProxyFrame="ProxyFrame",r.CustomIframe="CustomFrame",r.Unknown="Unknown"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(n){void 0===n&&(n="");var r=e.call(this,n)||this;return Object.defineProperty(r,"message",{configurable:!0,enumerable:!1,value:n,writable:!0}),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:r.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(r,r.constructor),r):(Object.defineProperty(r,"stack",{configurable:!0,enumerable:!1,value:new Error(n).stack,writable:!0}),Object.setPrototypeOf(r,t.prototype),r)}return i(t,e),t}(Error);t.default=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=n(3),s=function(){function e(){}return e.isBrowser=function(){return"undefined"!=typeof window},e.version=function(){return Number(150402)},Object.defineProperty(e,"TRADITIONAL_CHINESE_LANGUAGE_TAG",{get:function(){return["tw","hant"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SIMPLIFIED_CHINESE_LANGUAGE_TAG",{get:function(){return["cn","hans"]},enumerable:!0,configurable:!0}),e.getLanguage=function(){var t=navigator.language;if(t){var n=(t=t.toLowerCase()).split("-");if("zh"==n[0]){for(var r=0,i=e.TRADITIONAL_CHINESE_LANGUAGE_TAG;r<i.length;r++){var o=i[r];if(-1!==n.indexOf(o))return"zh-Hant"}for(var s=0,a=e.SIMPLIFIED_CHINESE_LANGUAGE_TAG;s<a.length;s++){var u=a[s];if(-1!==n.indexOf(u))return"zh-Hans"}return"zh-Hant"}return n[0].substring(0,2)}return"en"},e.supportsServiceWorkers=function(){switch(i.default.getWindowEnv()){case o.WindowEnvironmentKind.ServiceWorker:return!0;default:return"undefined"!=typeof navigator&&"serviceWorker"in navigator}},e.getSdkStylesVersionHash=function(){return"667d417dfeaee00d71566761c096042f"},e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(5)),a=o(n(0)),u=n(3),c=n(1),l=o(n(2)),d=["notifyButtonHovering","notifyButtonHover","notifyButtonButtonClick","notifyButtonLauncherClick","animatedElementHiding","animatedElementHidden","animatedElementShowing","animatedElementShown","activeAnimatedElementActivating","activeAnimatedElementActive","activeAnimatedElementInactivating","activeAnimatedElementInactive","dbRetrieved","dbSet","testEvent"],f=["onesignal.prompt.custom.clicked","onesignal.prompt.native.permissionchanged","onesignal.subscription.changed","onesignal.internal.subscriptionset","dbRebuilt","initialize","subscriptionSet","sendWelcomeNotification","subscriptionChange","notificationPermissionChange","dbSet","register","notificationDisplay","notificationDismiss","notificationClick","permissionPromptDisplay","testWouldDisplay","testInitOptionDisabled","popupWindowTimeout"],p={notificationPermissionChange:"onesignal.prompt.native.permissionchanged",subscriptionChange:"onesignal.subscription.changed",customPromptClick:"onesignal.prompt.custom.clicked"},h=function(){function e(){}return e.trigger=function(t,n,o){return void 0===o&&(o=null),r(this,void 0,void 0,function(){var r,h,g;return i(this,function(i){switch(i.label){case 0:if(c.contains(d,t)||(r=n,h=o?c.capitalize(a.default.getWindowEnv().toString())+" â¬¸ "+c.capitalize(o):c.capitalize(a.default.getWindowEnv().toString()),r||!1===r?l.default.debug("("+h+") Â» %c"+t+":",c.getConsoleStyle("event"),r):l.default.debug("("+h+") Â» %c"+t,c.getConsoleStyle("event"))),!s.default.isBrowser())return[3,2];if(t===OneSignal.EVENTS.SDK_INITIALIZED){if(OneSignal.initialized)return[2];OneSignal.initialized=!0}return[4,OneSignal.emitter.emit(t,n)];case 1:i.sent(),i.label=2;case 2:return p.hasOwnProperty(t)&&(g=p[t],e._triggerLegacy(g,n)),!s.default.isBrowser()||a.default.getWindowEnv()!==u.WindowEnvironmentKind.OneSignalSubscriptionPopup&&a.default.getWindowEnv()!==u.WindowEnvironmentKind.OneSignalProxyFrame||(opener||parent?c.contains(f,t)&&(a.default.getWindowEnv()===u.WindowEnvironmentKind.OneSignalSubscriptionPopup?OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,{eventName:t,eventData:n}):OneSignal.proxyFrame.retriggerRemoteEvent(t,n)):l.default.error("Could not send event '"+t+"' back to host page because no creator (opener or parent) found!")),[2]}})})},e._triggerLegacy=function(e,t){var n=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t});window.dispatchEvent(n)},e}();t.default=h},function(e,t,n){var r;r=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}var r,i,o,s=n(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),u=/nexus\s*[0-6]\s*/i.test(t),c=!u&&/nexus\s*[0-9]+/i.test(t),l=/CrOS/.test(t),d=/silk/i.test(t),f=/sailfish/i.test(t),p=/tizen/i.test(t),h=/(web|hpw)os/i.test(t),g=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!g&&/windows/i.test(t)),b=!s&&!d&&/macintosh/i.test(t),m=!a&&!f&&!p&&!h&&/linux/i.test(t),w=n(/edge\/(\d+(\.\d+)?)/i),S=n(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t)&&!/tablet pc/i.test(t),k=!y&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?r={name:"Opera",opera:e,version:S||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?r={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||S}:/SamsungBrowser/i.test(t)?r={name:"Samsung Internet for Android",samsungBrowser:e,version:S||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?r={name:"Opera Coast",coast:e,version:S||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?r={name:"Yandex Browser",yandexbrowser:e,version:S||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?r={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?r={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?r={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?r={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?r={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?r={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:g?(r={name:"Windows Phone",windowsphone:e},w?(r.msedge=e,r.version=w):(r.msie=e,r.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:l?r={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?r={name:"Microsoft Edge",msedge:e,version:w}:/vivaldi/i.test(t)?r={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||S}:f?r={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(r={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=e)):d?r={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?r={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",blackberry:e,version:S||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(r={name:"WebOS",webos:e,version:S||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=e)):/bada/i.test(t)?r={name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:p?r={name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||S}:/qupzilla/i.test(t)?r={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||S}:/chromium/i.test(t)?r={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||S}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?r={name:"Android",version:S}:/safari|applewebkit/i.test(t)?(r={name:"Safari",safari:e},S&&(r.version=S)):s?(r={name:"iphone"==s?"iPhone":"ipad"==s?"iPad":"iPod"},S&&(r.version=S)):r=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||S}:{name:n(/^(.*)\/(.*) /),version:(i=/^(.*)\/(.*) /,o=t.match(i),o&&o.length>1&&o[2]||"")},!r.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(r.name=r.name||"Blink",r.blink=e):(r.name=r.name||"Webkit",r.webkit=e),!r.version&&S&&(r.version=S)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=e,r.version=r.version||n(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||r.msedge||!a&&!r.silk?r.windowsphone||r.msedge||!s?b?r.mac=e:P?r.xbox=e:v?r.windows=e:m&&(r.linux=e):(r[s]=e,r.ios=e):r.android=e;var _="";r.windows?_=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?_=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?_=(_=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):s?_=(_=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?_=n(/android[ \/-](\d+(\.\d+)*)/i):r.webos?_=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?_=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?_=n(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(_=n(/tizen[\/\s](\d+(\.\d+)*)/i)),_&&(r.osversion=_);var O=!r.windows&&_.split(".")[0];return y||c||"ipad"==s||a&&(3==O||O>=4&&!k)||r.silk?r.tablet=e:(k||"iphone"==s||"ipod"==s||a||u||r.blackberry||r.webos||r.bada)&&(r.mobile=e),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=e:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=e:r.x=e,r}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function r(e){return e.split(".").length}function i(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)r.push(t(e[n]));return r}function o(e){for(var t=Math.max(r(e[0]),r(e[1])),n=i(e,function(e){var n=t-r(e);return i((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function s(e,r,i){var s=n;"string"==typeof r&&(i=r,r=void 0),void 0===r&&(r=!1),i&&(s=t(i));var a=""+s.version;for(var u in e)if(e.hasOwnProperty(u)&&s[u]){if("string"!=typeof e[u])throw new Error("Browser version in the minVersion map should be a string: "+u+": "+String(e));return o([a,e[u]])<0}return r}return n.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in n)return!0}return!1},n.isUnsupportedBrowser=s,n.compareVersions=o,n.check=function(e,t,n){return!s(e,t,n)},n._detect=t,n},void 0!==e&&e.exports?e.exports=r():n(65)("bowser",r)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(21)),u=o(n(0)),c=n(63),l=n(62),d=n(27),f=n(38),p=n(3),h=o(n(45)),g=n(44),v=n(1);!function(e){e[e.SET=0]="SET"}(s||(s={}));var b=function(){function e(e){this.databaseName=e,this.emitter=new a.default,this.database=new h.default(this.databaseName)}return e.applyDbResultFilter=function(e,t,n){switch(e){case"Options":return n&&t?n.value:n&&!t?n:null;case"Ids":return n&&t?n.id:n&&!t?n:null;case"NotificationOpened":return n&&t?{data:n.data,timestamp:n.timestamp}:n&&!t?n:null;default:return n||null}},e.prototype.get=function(t,n){return r(this,void 0,void 0,function(){var o=this;return i(this,function(s){switch(s.label){case 0:return[4,new Promise(function(s){return r(o,void 0,void 0,function(){var r,o;return i(this,function(i){switch(i.label){case 0:return u.default.getWindowEnv()!==p.WindowEnvironmentKind.ServiceWorker&&v.isUsingSubscriptionWorkaround()&&u.default.getTestEnv()===f.TestEnvironmentKind.None?(OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET,[{table:t,key:n}],function(e){var t=e.data[0];s(t)}),[3,3]):[3,1];case 1:return[4,this.database.get(t,n)];case 2:r=i.sent(),o=e.applyDbResultFilter(t,n,r),s(o),i.label=3;case 3:return[2]}})})})];case 1:return[2,s.sent()]}})})},e.prototype.put=function(t,n){return r(this,void 0,void 0,function(){var o=this;return i(this,function(s){switch(s.label){case 0:return[4,new Promise(function(e,s){return r(o,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return u.default.getWindowEnv()!==p.WindowEnvironmentKind.ServiceWorker&&v.isUsingSubscriptionWorkaround()&&u.default.getTestEnv()===f.TestEnvironmentKind.None?(OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT,[{table:t,keypath:n}],function(r){r.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?e():s("(Database) Attempted remote IndexedDB put("+t+", "+n+"), but did not get success response.")}),[3,3]):[3,1];case 1:return[4,this.database.put(t,n)];case 2:r.sent(),e(),r.label=3;case 3:return[2]}})})})];case 1:return s.sent(),this.emitter.emit(e.EVENTS.SET,n),[2]}})})},e.prototype.remove=function(e,t){return u.default.getWindowEnv()!==p.WindowEnvironmentKind.ServiceWorker&&v.isUsingSubscriptionWorkaround()&&u.default.getTestEnv()===f.TestEnvironmentKind.None?new Promise(function(n,r){OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE,[{table:e,keypath:t}],function(i){i.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?n():r("(Database) Attempted remote IndexedDB remove("+e+", "+t+"), but did not get success response.")})}):this.database.remove(e,t)},e.prototype.getAppConfig=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o;return i(this,function(i){switch(i.label){case 0:return e={},[4,this.get("Ids","appId")];case 1:return t=i.sent(),e.appId=t,n=e,[4,this.get("Options","subdomain")];case 2:return n.subdomain=i.sent(),r=e,[4,this.get("Options","vapidPublicKey")];case 3:return r.vapidPublicKey=i.sent(),o=e,[4,this.get("Options","emailAuthRequired")];case 4:return o.emailAuthRequired=i.sent(),[2,e]}})})},e.prototype.setAppConfig=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.appId?[4,this.put("Ids",{type:"appId",id:e.appId})]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.subdomain?[4,this.put("Options",{key:"subdomain",value:e.subdomain})]:[3,4];case 3:t.sent(),t.label=4;case 4:return!0!==e.httpUseOneSignalCom?[3,6]:[4,this.put("Options",{key:"httpUseOneSignalCom",value:!0})];case 5:return t.sent(),[3,8];case 6:return!1!==e.httpUseOneSignalCom?[3,8]:[4,this.put("Options",{key:"httpUseOneSignalCom",value:!1})];case 7:t.sent(),t.label=8;case 8:return!0!==e.emailAuthRequired?[3,10]:[4,this.put("Options",{key:"emailAuthRequired",value:!0})];case 9:return t.sent(),[3,12];case 10:return!1!==e.emailAuthRequired?[3,12]:[4,this.put("Options",{key:"emailAuthRequired",value:!1})];case 11:t.sent(),t.label=12;case 12:return e.vapidPublicKey?[4,this.put("Options",{key:"vapidPublicKey",value:e.vapidPublicKey})]:[3,14];case 13:t.sent(),t.label=14;case 14:return[2]}})})},e.prototype.getAppState=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o;return i(this,function(i){switch(i.label){case 0:return e=new c.AppState,t=e,[4,this.get("Options","defaultUrl")];case 1:return t.defaultNotificationUrl=i.sent(),n=e,[4,this.get("Options","defaultTitle")];case 2:return n.defaultNotificationTitle=i.sent(),r=e,[4,this.get("Options","isPushEnabled")];case 3:return r.lastKnownPushEnabled=i.sent(),o=e,[4,this.get("NotificationOpened")];case 4:return o.clickedNotifications=i.sent(),[2,e]}})})},e.prototype.setAppState=function(e){return r(this,void 0,void 0,function(){var t,n,r,o,s;return i(this,function(i){switch(i.label){case 0:return e.defaultNotificationUrl?[4,this.put("Options",{key:"defaultUrl",value:e.defaultNotificationUrl})]:[3,2];case 1:i.sent(),i.label=2;case 2:return e.defaultNotificationTitle||""===e.defaultNotificationTitle?[4,this.put("Options",{key:"defaultTitle",value:e.defaultNotificationTitle})]:[3,4];case 3:i.sent(),i.label=4;case 4:return null==e.lastKnownPushEnabled?[3,6]:[4,this.put("Options",{key:"isPushEnabled",value:e.lastKnownPushEnabled})];case 5:i.sent(),i.label=6;case 6:if(!e.clickedNotifications)return[3,12];t=Object.keys(e.clickedNotifications),n=0,r=t,i.label=7;case 7:return n<r.length?(o=r[n],(s=e.clickedNotifications[o])?[4,this.put("NotificationOpened",{url:o,data:s.data,timestamp:s.timestamp})]:[3,9]):[3,12];case 8:return i.sent(),[3,11];case 9:return null!==s?[3,11]:[4,this.remove("NotificationOpened",o)];case 10:i.sent(),i.label=11;case 11:return n++,[3,7];case 12:return[2]}})})},e.prototype.getServiceWorkerState=function(){return r(this,void 0,void 0,function(){var e,t,n,r;return i(this,function(i){switch(i.label){case 0:return e=new l.ServiceWorkerState,t=e,[4,this.get("Ids","WORKER1_ONE_SIGNAL_SW_VERSION")];case 1:return t.workerVersion=i.sent(),n=e,[4,this.get("Ids","WORKER2_ONE_SIGNAL_SW_VERSION")];case 2:return n.updaterWorkerVersion=i.sent(),r=e,[4,this.get("Ids","backupNotification")];case 3:return r.backupNotification=i.sent(),[2,e]}})})},e.prototype.setServiceWorkerState=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.workerVersion?[4,this.put("Ids",{type:"WORKER1_ONE_SIGNAL_SW_VERSION",id:e.workerVersion})]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.updaterWorkerVersion?[4,this.put("Ids",{type:"WORKER2_ONE_SIGNAL_SW_VERSION",id:e.updaterWorkerVersion})]:[3,4];case 3:t.sent(),t.label=4;case 4:return e.backupNotification?[4,this.put("Ids",{type:"backupNotification",id:e.backupNotification})]:[3,6];case 5:t.sent(),t.label=6;case 6:return[2]}})})},e.prototype.getSubscription=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,s,a;return i(this,function(i){switch(i.label){case 0:return e=new d.Subscription,t=e,[4,this.get("Ids","userId")];case 1:return t.deviceId=i.sent(),n=e,[4,this.get("Ids","registrationId")];case 2:return n.subscriptionToken=i.sent(),[4,this.get("Options","optedOut")];case 3:return r=i.sent(),[4,this.get("Options","subscription")];case 4:return o=i.sent(),[4,this.get("Options","subscriptionCreatedAt")];case 5:return s=i.sent(),[4,this.get("Options","subscriptionExpirationTime")];case 6:return a=i.sent(),e.optedOut=null!=r?r:null!=o&&!o,e.createdAt=s,e.expirationTime=a,[2,e]}})})},e.prototype.setSubscription=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.deviceId&&e.deviceId?[4,this.put("Ids",{type:"userId",id:e.deviceId})]:[3,2];case 1:t.sent(),t.label=2;case 2:return void 0===e.subscriptionToken?[3,4]:[4,this.put("Ids",{type:"registrationId",id:e.subscriptionToken})];case 3:t.sent(),t.label=4;case 4:return null==e.optedOut?[3,6]:[4,this.put("Options",{key:"optedOut",value:e.optedOut})];case 5:t.sent(),t.label=6;case 6:return null==e.createdAt?[3,8]:[4,this.put("Options",{key:"subscriptionCreatedAt",value:e.createdAt})];case 7:t.sent(),t.label=8;case 8:return null==e.expirationTime?[3,10]:[4,this.put("Options",{key:"subscriptionExpirationTime",value:e.expirationTime})];case 9:return t.sent(),[3,12];case 10:return[4,this.remove("Options","subscriptionExpirationTime")];case 11:t.sent(),t.label=12;case 12:return[2]}})})},e.prototype.getEmailProfile=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.get("Ids","emailProfile")];case 1:return(e=t.sent())?[2,g.EmailProfile.deserialize(e)]:[2,new g.EmailProfile]}})})},e.prototype.setEmailProfile=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e?[4,this.put("Ids",{type:"emailProfile",id:e.serialize()})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.setProvideUserConsent=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.put("Options",{key:"userConsent",value:e})];case 1:return t.sent(),[2]}})})},e.prototype.getProvideUserConsent=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this.get("Options","userConsent")];case 1:return[2,e.sent()]}})})},e.rebuild=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,Promise.all([e.databaseInstance.remove("Ids"),e.databaseInstance.remove("NotificationOpened"),e.databaseInstance.remove("Options")])]})})},e.ensureSingletonInstance=function(){e.databaseInstanceName||(e.databaseInstanceName="ONE_SIGNAL_SDK_DB"),e.databaseInstance||(e.databaseInstance=new e(e.databaseInstanceName))},e.on=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.emitter.on.apply(e.databaseInstance.emitter,t)]})})},e.setEmailProfile=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setEmailProfile.call(e.databaseInstance,t)]})})},e.getEmailProfile=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getEmailProfile.call(e.databaseInstance)]})})},e.setSubscription=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setSubscription.call(e.databaseInstance,t)]})})},e.getSubscription=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getSubscription.call(e.databaseInstance)]})})},e.setProvideUserConsent=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setProvideUserConsent.call(e.databaseInstance,t)]})})},e.getProvideUserConsent=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getProvideUserConsent.call(e.databaseInstance)]})})},e.setServiceWorkerState=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setServiceWorkerState.call(e.databaseInstance,t)]})})},e.getServiceWorkerState=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getServiceWorkerState.call(e.databaseInstance)]})})},e.setAppState=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setAppState.call(e.databaseInstance,t)]})})},e.getAppState=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getAppState.call(e.databaseInstance)]})})},e.setAppConfig=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){return e.ensureSingletonInstance(),[2,e.databaseInstance.setAppConfig.call(e.databaseInstance,t)]})})},e.getAppConfig=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return e.ensureSingletonInstance(),[2,e.databaseInstance.getAppConfig.call(e.databaseInstance)]})})},e.remove=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(r){return e.ensureSingletonInstance(),[2,e.databaseInstance.remove.call(e.databaseInstance,t,n)]})})},e.put=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(r){return e.ensureSingletonInstance(),[2,e.databaseInstance.put.call(e.databaseInstance,t,n)]})})},e.get=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(r){return e.ensureSingletonInstance(),[2,e.databaseInstance.get.call(e.databaseInstance,t,n)]})})},e}();t.default=b,b.EVENTS=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var n=e.call(this,"This code is not implemented yet.")||this;return Object.setPrototypeOf(n,t.prototype),n}return i(t,e),t}(o(n(4)).default);t.default=s},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(60)),u=s(n(5)),c=s(n(0)),l=n(1),d=n(59),f=n(3),p=n(15),h=s(n(2)),g=n(34),v=function(){function e(){}return e.get=function(t,n,r){return e.call("GET",t,n,r)},e.post=function(t,n,r){return e.call("POST",t,n,r)},e.put=function(t,n,r){return e.call("PUT",t,n,r)},e.delete=function(t,n,r){return e.call("DELETE",t,n,r)},e.call=function(t,n,r,i){var o=new Headers;if(o.append("SDK-Version","onesignal/web/"+u.default.version()),o.append("Content-Type","application/json;charset=UTF-8"),i)for(var s=0,a=Object.keys(i);s<a.length;s++){var l=a[s];o.append(l,i[l])}var d,f={method:t||"NO_METHOD_SPECIFIED",headers:o,cache:"no-cache"};return r&&(f.body=JSON.stringify(r)),fetch(c.default.getOneSignalApiUrl().toString()+"/"+n,f).then(function(e){return d=e.status,e.json()}).then(function(t){return d>=200&&d<300?t:"no-user-id-error"!==e.identifyError(t)?Promise.reject(t):void 0})},e.identifyError=function(e){if(!e||!e.errors)return"no-error";var t=e.errors;return l.contains(t,"No user with this id found")||l.contains(t,"Could not find app_id for given player id.")?"no-user-id-error":"unknown-error"},e.getUserIdFromSubscriptionIdentifier=function(t,n,r){return e.post("players",{app_id:t,device_type:n,identifier:r,notification_types:p.SubscriptionStateKind.TemporaryWebRecord}).then(function(e){return e&&e.id?e.id:null}).catch(function(e){return h.default.debug("Error getting user ID from subscription identifier:",e),null})},e.getPlayer=function(t,n){return e.get("players/"+n+"?app_id="+t)},e.updatePlayer=function(t,n,i){return e.put("players/"+n,r({app_id:t},i))},e.sendNotification=function(t,n,r,i,o,s,a,u){var c={app_id:t,contents:i,include_player_ids:n,isAnyWeb:!0,data:a,web_buttons:u};return r&&(c.headings=r),o&&(c.url=o),s&&(c.chrome_web_icon=s,c.firefox_icon=s),l.trimUndefined(c),e.post("notifications",c)},e.jsonpLib=function(e,t){a.default(e,null,t)},e.downloadServerAppConfig=function(t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n,r){c.default.getWindowEnv()!==f.WindowEnvironmentKind.ServiceWorker?e.jsonpLib(c.default.getOneSignalApiUrl().toString()+"/sync/"+t+"/web",function(e,t){e?r(e):t.success?n(t):r(t)}):n(e.get("sync/"+t+"/web",null))})];case 1:return[2,n.sent()]}})})},e.createUser=function(t){return i(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return[4,e.post("players",t.serialize())];case 1:return(n=r.sent())&&n.success?[2,n.id]:[2,null]}})})},e.createEmailRecord=function(t,n,r){return i(this,void 0,void 0,function(){var i,s;return o(this,function(o){switch(o.label){case 0:return(i=new g.EmailDeviceRecord(n.emailAddress,n.emailAuthHash)).appId=t.appId,i.pushDeviceRecordId=r,[4,e.post("players",i.serialize())];case 1:return(s=o.sent())&&s.success?[2,s.id]:[2,null]}})})},e.updateEmailRecord=function(t,n,r){return i(this,void 0,void 0,function(){var i,s;return o(this,function(o){switch(o.label){case 0:return(i=new g.EmailDeviceRecord(n.emailAddress,n.emailAuthHash)).appId=t.appId,i.pushDeviceRecordId=r,[4,e.put("players/"+n.emailId,i.serialize())];case 1:return(s=o.sent())&&s.success?[2,s.id]:[2,null]}})})},e.logoutEmail=function(t,n,r){return i(this,void 0,void 0,function(){var i;return o(this,function(o){switch(o.label){case 0:return[4,e.post("players/"+r+"/email_logout",{app_id:t.appId,parent_player_id:n.emailId,email_auth_hash:n.emailAuthHash?n.emailAuthHash:void 0})];case 1:return(i=o.sent())&&i.success?[2,!0]:[2,!1]}})})},e.updateUserSession=function(t,n){return i(this,void 0,void 0,function(){var r,i;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.post("players/"+t+"/on_session",n.serialize())];case 1:return(r=o.sent()).id?[2,r.id]:[2,t];case 2:throw(i=o.sent())&&Array.isArray(i.errors)&&i.errors.length>0&&l.contains(i.errors[0],"app_id not found")?new d.OneSignalApiError(d.OneSignalApiErrorKind.MissingAppId):i;case 3:return[2]}})})},e}();t.default=v},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4));(s=t.PushPermissionNotGrantedErrorReason||(t.PushPermissionNotGrantedErrorReason={}))[s.Blocked=0]="Blocked",s[s.Dismissed=1]="Dismissed",s[s.Default=2]="Default";var PushPermissionNotGrantedError=function(e){function PushPermissionNotGrantedError(n){var r=this;switch(n){case t.PushPermissionNotGrantedErrorReason.Dismissed:r=e.call(this,"The user dismissed the permission prompt.")||this;break;case t.PushPermissionNotGrantedErrorReason.Blocked:r=e.call(this,"Notification permissions are blocked.")||this;break;case t.PushPermissionNotGrantedErrorReason.Default:r=e.call(this,"Notification permissions have not been granted yet.")||this}return r.reason=n,Object.setPrototypeOf(r,PushPermissionNotGrantedError.prototype),r}return i(PushPermissionNotGrantedError,e),PushPermissionNotGrantedError}(a.default);t.default=PushPermissionNotGrantedError},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4)),u=n(46);(s=t.InvalidStateReason||(t.InvalidStateReason={}))[s.MissingAppId=0]="MissingAppId",s[s.RedundantPermissionMessage=1]="RedundantPermissionMessage",s[s.PushPermissionAlreadyGranted=2]="PushPermissionAlreadyGranted",s[s.UnsupportedEnvironment=3]="UnsupportedEnvironment",s[s.MissingDomElement=4]="MissingDomElement",s[s.ServiceWorkerNotActivated=5]="ServiceWorkerNotActivated",s[s.NoProxyFrame=6]="NoProxyFrame";var InvalidStateError=function(e){function InvalidStateError(n,r){var i=this;switch(n){case t.InvalidStateReason.MissingAppId:i=e.call(this,"Missing required app ID.")||this;break;case t.InvalidStateReason.RedundantPermissionMessage:var o="";r&&r.permissionPromptType&&(o="("+u.PermissionPromptType[r.permissionPromptType]+")"),i=e.call(this,"Another permission message "+o+" is being displayed.")||this;break;case t.InvalidStateReason.PushPermissionAlreadyGranted:i=e.call(this,"Push permission has already been granted.")||this;break;case t.InvalidStateReason.UnsupportedEnvironment:i=e.call(this,"The current environment does not support this operation.")||this;break;case t.InvalidStateReason.ServiceWorkerNotActivated:i=e.call(this,"The service worker must be activated first.")||this;break;case t.InvalidStateReason.NoProxyFrame:i=e.call(this,"No proxy frame.")||this}return i.description=t.InvalidStateReason[n],i.reason=n,Object.setPrototypeOf(i,InvalidStateError.prototype),i}return i(InvalidStateError,e),InvalidStateError}(a.default);t.InvalidStateError=InvalidStateError},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(5)),u=n(12),c=n(17),l=o(n(37)),d=o(n(0)),f=n(27),p=n(1),h=o(n(8)),g=n(18),v=n(3),b=o(n(9)),m=o(n(2)),w=o(n(6)),S=o(n(35)),y=o(n(26));(s=t.ServiceWorkerActiveState||(t.ServiceWorkerActiveState={})).WorkerA="Worker A (Main)",s.WorkerB="Worker B (Updater)",s.ThirdParty="3rd Party",s.Installing="Installing",s.None="None",s.Bypassed="Bypassed",s.Indeterminate="Indeterminate";var k=function(){function e(e,t){this.context=e,this.config=t}return e.getRegistration=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,navigator.serviceWorker.getRegistration(location.href)];case 1:return[2,e.sent()];case 2:return e.sent(),m.default.warn("[Service Worker Status] Error Checking service worker registration"),[2,null];case 3:return[2]}})})},e.prototype.getActiveState=function(){return r(this,void 0,void 0,function(){var n,r,o,s,a,u;return i(this,function(i){switch(i.label){case 0:return[4,d.default.getIntegration()];case 1:return(n=i.sent())!==g.IntegrationKind.InsecureProxy?[3,2]:[2,t.ServiceWorkerActiveState.Indeterminate];case 2:if(n!==g.IntegrationKind.SecureProxy)return[3,8];switch(r=d.default.getWindowEnv(),r){case v.WindowEnvironmentKind.Host:case v.WindowEnvironmentKind.CustomIframe:return[3,3];case v.WindowEnvironmentKind.OneSignalSubscriptionPopup:return[3,6];case v.WindowEnvironmentKind.OneSignalSubscriptionModal:return[3,7]}return[3,8];case 3:return(o=OneSignal.proxyFrameHost)?[3,4]:[2,t.ServiceWorkerActiveState.Indeterminate];case 4:return[4,o.runCommand(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE)];case 5:return[2,i.sent()];case 6:return[3,8];case 7:throw new b.default;case 8:return[4,e.getRegistration()];case 9:return(s=i.sent())?s.installing?[2,t.ServiceWorkerActiveState.Installing]:s.active?(a=new URL(s.active.scriptURL).pathname,u=new l.default(a).getFileName()==this.config.workerAPath.getFileName()?t.ServiceWorkerActiveState.WorkerA:new l.default(a).getFileName()==this.config.workerBPath.getFileName()?t.ServiceWorkerActiveState.WorkerB:t.ServiceWorkerActiveState.ThirdParty,navigator.serviceWorker.controller||u!==t.ServiceWorkerActiveState.WorkerA&&u!==t.ServiceWorkerActiveState.WorkerB?[2,u]:[2,t.ServiceWorkerActiveState.Bypassed]):[2,t.ServiceWorkerActiveState.ThirdParty]:[2,t.ServiceWorkerActiveState.None]}})})},e.prototype.getWorkerVersion=function(){return r(this,void 0,void 0,function(){var e=this;return i(this,function(t){return[2,new Promise(function(t){return r(e,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return p.isUsingSubscriptionWorkaround()?(e=OneSignal.proxyFrameHost)?[3,1]:(t(NaN),[3,3]):[3,4];case 1:return[4,e.runCommand(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION)];case 2:n=r.sent(),t(n),r.label=3;case 3:return[3,5];case 4:this.context.workerMessenger.once(c.WorkerMessengerCommand.WorkerVersion,function(e){t(e)}),this.context.workerMessenger.unicast(c.WorkerMessengerCommand.WorkerVersion),r.label=5;case 5:return[2]}})})})]})})},e.prototype.shouldInstallWorker=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return[4,this.getActiveState()];case 1:return(e=n.sent())!==t.ServiceWorkerActiveState.WorkerA&&e!==t.ServiceWorkerActiveState.WorkerB?[2,!0]:[2,!1]}})})},e.prototype.subscribeForPushNotifications=function(){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){switch(r.label){case 0:return[4,this.getActiveState()];case 1:if((e=r.sent())!==t.ServiceWorkerActiveState.WorkerA&&e!==t.ServiceWorkerActiveState.WorkerB)throw new u.InvalidStateError(u.InvalidStateReason.ServiceWorkerNotActivated);return[2,new Promise(function(e){n.context.workerMessenger.once(c.WorkerMessengerCommand.Subscribe,function(t){e(f.Subscription.deserialize(t))}),n.context.workerMessenger.unicast(c.WorkerMessengerCommand.Subscribe,n.context.appConfig)})]}})})},e.prototype.updateWorker=function(){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return a.default.supportsServiceWorkers()?[4,this.getActiveState()]:[2];case 1:e=r.sent(),m.default.info("[Service Worker Update] Checking service worker version..."),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,p.timeoutPromise(this.getWorkerVersion(),2e3)];case 3:return n=r.sent(),[3,5];case 4:return r.sent(),m.default.info("[Service Worker Update] Worker did not reply to version query; assuming older version."),n=1,[3,5];case 5:return e!==t.ServiceWorkerActiveState.WorkerA&&e!==t.ServiceWorkerActiveState.WorkerB?(m.default.debug("[Service Worker Update] Not updating service worker, current active worker state is "+e+"."),[2]):n===a.default.version()?[3,7]:(m.default.info("[Service Worker Update] Updating service worker from v"+n+" --\x3e v"+a.default.version()+"."),[4,this.installWorker()]);case 6:return r.sent(),[3,8];case 7:m.default.info("[Service Worker Update] Service worker version is current at v"+n+" (no update required)."),r.label=8;case 8:return[2]}})})},e.prototype.installWorker=function(){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(o){switch(o.label){case 0:return a.default.supportsServiceWorkers()?[4,this.getActiveState()]:[2];case 1:return e=o.sent(),[4,this.installAlternatingWorker()];case 2:return o.sent(),[4,new Promise(function(o){return r(n,void 0,void 0,function(){var n,s=this;return i(this,function(a){switch(a.label){case 0:return[4,this.getActiveState()];case 1:return n=a.sent(),e!==n&&n!==t.ServiceWorkerActiveState.Installing?o():navigator.serviceWorker.addEventListener("controllerchange",function(n){return r(s,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return[4,this.getActiveState()];case 1:return(n=r.sent())!==e&&n!==t.ServiceWorkerActiveState.Installing&&o(),[2]}})})}),[2]}})})})];case 3:return o.sent(),[4,this.getActiveState()];case 4:return o.sent()!==t.ServiceWorkerActiveState.WorkerB?[3,6]:[4,this.installAlternatingWorker()];case 5:o.sent(),o.label=6;case 6:return[4,this.establishServiceWorkerChannel()];case 7:return o.sent(),[2]}})})},e.prototype.establishServiceWorkerChannel=function(){return r(this,void 0,void 0,function(){var e,t=this;return i(this,function(n){return(e=this.context.workerMessenger).off(),e.on(c.WorkerMessengerCommand.NotificationDisplayed,function(e){m.default.debug(location.origin,"Received notification display event from service worker."),w.default.trigger(OneSignal.EVENTS.NOTIFICATION_DISPLAYED,e)}),e.on(c.WorkerMessengerCommand.NotificationClicked,function(e){return r(t,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return d.default.getWindowEnv()!==v.WindowEnvironmentKind.OneSignalProxyFrame?[3,2]:[4,new Promise(function(e){var t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT,OneSignal.EVENTS.NOTIFICATION_CLICKED,function(t){var n=t.data;e(n)})})];case 1:return t=r.sent(),[3,3];case 2:t=OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED),r.label=3;case 3:return 0!==t?[3,5]:(m.default.debug("notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval."),n=e.url,e.url||(n=location.href),[4,h.default.put("NotificationOpened",{url:n,data:e,timestamp:Date.now()})]);case 4:return r.sent(),[3,6];case 5:w.default.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,e),r.label=6;case 6:return[2]}})})}),e.on(c.WorkerMessengerCommand.RedirectPage,function(e){m.default.debug(d.default.getWindowEnv().toString()+" Picked up command.redirect to "+e+", forwarding to host page.");var t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT,e)}),e.on(c.WorkerMessengerCommand.NotificationDismissed,function(e){w.default.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED,e)}),[2]})})},e.getServiceWorkerHref=function(e,n){var r="";if(e===t.ServiceWorkerActiveState.WorkerA)r=n.workerBPath.getFullPath();else if(e===t.ServiceWorkerActiveState.WorkerB||e===t.ServiceWorkerActiveState.ThirdParty||e===t.ServiceWorkerActiveState.None)r=n.workerAPath.getFullPath();else if(e===t.ServiceWorkerActiveState.Bypassed)throw new u.InvalidStateError(u.InvalidStateReason.UnsupportedEnvironment);return new URL(r,y.default.getBaseUrl()).href},e.prototype.installAlternatingWorker=function(){return r(this,void 0,void 0,function(){var n,r,o,s,a,u,c;return i(this,function(i){switch(i.label){case 0:return[4,this.getActiveState()];case 1:return(n=i.sent())!==t.ServiceWorkerActiveState.ThirdParty?[3,4]:[4,e.getRegistration()];case 2:return(r=i.sent())?[4,r.unregister()]:[3,4];case 3:i.sent(),i.label=4;case 4:o=e.getServiceWorkerHref(n,this.config),s=p.encodeHashAsUriComponent({appId:this.context.appConfig.appId}),a=o+"?"+s,m.default.info("[Service Worker Installation] Installing service worker "+a+"."),i.label=5;case 5:return i.trys.push([5,7,,9]),[4,navigator.serviceWorker.register(a,{scope:""+y.default.getBaseUrl()+this.config.registrationOptions.scope})];case 6:return i.sent(),[3,9];case 7:if(u=i.sent(),m.default.error("[Service Worker Installation] Installing service worker failed "+u),d.default.getWindowEnv()===v.WindowEnvironmentKind.OneSignalSubscriptionPopup)throw u;return[4,fetch(a)];case 8:if(403===(c=i.sent()).status||404===c.status)throw new S.default(c.status,c.statusText);throw u;case 9:return m.default.debug("[Service Worker Installation] Service worker installed."),[2]}})})},e}();t.ServiceWorkerManager=k},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4));(s=t.InvalidArgumentReason||(t.InvalidArgumentReason={}))[s.Empty=0]="Empty",s[s.Malformed=1]="Malformed",s[s.EnumOutOfRange=2]="EnumOutOfRange";var InvalidArgumentError=function(e){function InvalidArgumentError(n,r){var i=this;switch(r){case t.InvalidArgumentReason.Empty:i=e.call(this,"Supply a non-empty value to '"+n+"'.")||this;break;case t.InvalidArgumentReason.Malformed:i=e.call(this,"The value for '"+n+"' was malformed.")||this;break;case t.InvalidArgumentReason.EnumOutOfRange:i=e.call(this,"The value for '"+n+"' was out of range of the expected input enum.")||this}return i.argument=n,i.reason=t.InvalidArgumentReason[r],Object.setPrototypeOf(i,InvalidArgumentError.prototype),i}return i(InvalidArgumentError,e),InvalidArgumentError}(a.default);t.InvalidArgumentError=InvalidArgumentError},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SubscriptionStateKind||(t.SubscriptionStateKind={}))[r.Subscribed=1]="Subscribed",r[r.MutedByApi=-2]="MutedByApi",r[r.NotSubscribed=-10]="NotSubscribed",r[r.TemporaryWebRecord=-20]="TemporaryWebRecord",r[r.PermissionRevoked=-21]="PermissionRevoked",r[r.PushSubscriptionRevoked=-22]="PushSubscriptionRevoked",r[r.ServiceWorkerStatus403=-23]="ServiceWorkerStatus403",r[r.ServiceWorkerStatus404=-24]="ServiceWorkerStatus404"},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPermission=r,function(e){e.Default="default",e.Granted="granted",e.Denied="denied"}(r||(t.NotificationPermission=r={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(14),u=o(n(0)),c=n(13),l=n(3),d=o(n(5)),f=o(n(2));(s=t.WorkerMessengerCommand||(t.WorkerMessengerCommand={})).WorkerVersion="GetWorkerVersion",s.Subscribe="Subscribe",s.SubscribeNew="SubscribeNew",s.AmpSubscriptionState="amp-web-push-subscription-state",s.AmpSubscribe="amp-web-push-subscribe",s.AmpUnsubscribe="amp-web-push-unsubscribe",s.NotificationDisplayed="notification.displayed",s.NotificationClicked="notification.clicked",s.NotificationDismissed="notification.dismissed",s.RedirectPage="command.redirect";var p=function(){function e(){this.replies={}}return e.prototype.addListener=function(e,t,n){var r={callback:t,onceListenerOnly:n},i=this.replies[e.toString()];i?i.push(r):this.replies[e.toString()]=[r]},e.prototype.findListenersForMessage=function(e){return this.replies[e.toString()]||[]},e.prototype.deleteListenerRecords=function(e){this.replies[e.toString()]=null},e.prototype.deleteAllListenerRecords=function(){this.replies={}},e.prototype.deleteListenerRecord=function(e,t){var n=this.replies[e.toString()];if(null!=n)for(var r=n.length-1;r>=0;r--){n[r]===t&&n.splice(r,1)}},e}();t.WorkerMessengerReplyBuffer=p;var h=function(){function e(e,t){void 0===t&&(t=new p),this.context=e,this.replies=t,this.debug=!0}return e.prototype.broadcast=function(e,t){return r(this,void 0,void 0,function(){var n,r,o,s;return i(this,function(i){switch(i.label){case 0:return u.default.getWindowEnv()===l.WindowEnvironmentKind.ServiceWorker?[3,1]:[2];case 1:return[4,self.clients.matchAll({type:"window",includeUncontrolled:!0})];case 2:for(n=i.sent(),r=0,o=n;r<o.length;r++)s=o[r],f.default.debug("[Worker Messenger] [SW -> Page] Broadcasting '"+e.toString()+"' to window client "+s.url+"."),s.postMessage({command:e,payload:t});i.label=3;case 3:return[2]}})})},e.prototype.unicast=function(e,t,n){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:if(u.default.getWindowEnv()!==l.WindowEnvironmentKind.ServiceWorker)return[3,1];if(!n)throw new a.InvalidArgumentError("windowClient",a.InvalidArgumentReason.Empty);return f.default.debug("[Worker Messenger] [SW -> Page] Unicasting '"+e.toString()+"' to window client "+n.url+"."),n.postMessage({command:e,payload:t}),[3,4];case 1:return[4,this.isWorkerControllingPage()];case 2:return r.sent()||f.default.debug("[Worker Messenger] The page is not controlled by the service worker yet. Waiting...",self.registration),[4,this.waitUntilWorkerControlsPage()];case 3:r.sent(),f.default.debug("[Worker Messenger] [Page -> SW] Unicasting '"+e.toString()+"' to service worker."),navigator.serviceWorker.controller.postMessage({command:e,payload:t}),r.label=4;case 4:return[2]}})})},e.prototype.listen=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return d.default.supportsServiceWorkers()?u.default.getWindowEnv()!==l.WindowEnvironmentKind.ServiceWorker?[3,1]:(self.addEventListener("message",this.onWorkerMessageReceivedFromPage.bind(this)),f.default.debug("[Worker Messenger] Service worker is now listening for messages."),[3,3]):[2];case 1:return[4,this.listenForPage(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e.prototype.listenForPage=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e?[3,3]:[4,this.isWorkerControllingPage()];case 1:return t.sent()||f.default.debug("("+location.origin+") [Worker Messenger] The page is not controlled by the service worker yet. Waiting...",self.registration),[4,this.waitUntilWorkerControlsPage()];case 2:t.sent(),f.default.debug("("+location.origin+") [Worker Messenger] The page is now controlled by the service worker."),t.label=3;case 3:return navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker.bind(this)),f.default.debug("("+location.origin+") [Worker Messenger] Page is now listening for messages."),[2]}})})},e.prototype.onWorkerMessageReceivedFromPage=function(e){var t=e.data;if(t&&t.command){var n=this.replies.findListenersForMessage(t.command),r=[],i=[];f.default.debug("[Worker Messenger] Service worker received message:",e.data);for(var o=0,s=n;o<s.length;o++){(u=s[o]).onceListenerOnly&&r.push(u),i.push(u)}for(var a=r.length-1;a>=0;a--){var u=r[a];this.replies.deleteListenerRecord(t.command,u)}for(var c=0,l=i;c<l.length;c++){(u=l[c]).callback.apply(null,[t.payload])}}},e.prototype.onPageMessageReceivedFromServiceWorker=function(e){var t=e.data;if(t&&t.command){var n=this.replies.findListenersForMessage(t.command),r=[],i=[];f.default.debug("[Worker Messenger] Page received message:",e.data);for(var o=0,s=n;o<s.length;o++){(u=s[o]).onceListenerOnly&&r.push(u),i.push(u)}for(var a=r.length-1;a>=0;a--){var u=r[a];this.replies.deleteListenerRecord(t.command,u)}for(var c=0,l=i;c<l.length;c++){(u=l[c]).callback.apply(null,[t.payload])}}},e.prototype.on=function(e,t){this.replies.addListener(e,t,!1)},e.prototype.once=function(e,t){this.replies.addListener(e,t,!0)},e.prototype.off=function(e){e?this.replies.deleteListenerRecords(e):this.replies.deleteAllListenerRecords()},e.prototype.isWorkerControllingPage=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return u.default.getWindowEnv()!==l.WindowEnvironmentKind.ServiceWorker?[3,1]:[2,!!self.registration.active];case 1:return[4,this.context.serviceWorkerManager.getActiveState()];case 2:return[2,(e=t.sent())===c.ServiceWorkerActiveState.WorkerA||e===c.ServiceWorkerActiveState.WorkerB]}})})},e.prototype.waitUntilWorkerControlsPage=function(){return r(this,void 0,void 0,function(){var e=this;return i(this,function(t){return[2,new Promise(function(t){return r(e,void 0,void 0,function(){var e=this;return i(this,function(n){switch(n.label){case 0:return[4,this.isWorkerControllingPage()];case 1:return n.sent()?t():u.default.getWindowEnv()===l.WindowEnvironmentKind.ServiceWorker?self.addEventListener("activate",function(n){return r(e,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this.isWorkerControllingPage()];case 1:return e.sent()&&t(),[2]}})})}):navigator.serviceWorker.addEventListener("controllerchange",function(n){return r(e,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this.isWorkerControllingPage()];case 1:return e.sent()&&t(),[2]}})})}),[2]}})})})]})})},e}();t.WorkerMessenger=h},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.IntegrationKind||(t.IntegrationKind={})).Secure="Secure",r.SecureProxy="Secure Proxy",r.InsecureProxy="Insecure Proxy"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4));(s=t.SdkInitErrorKind||(t.SdkInitErrorKind={}))[s.InvalidAppId=0]="InvalidAppId",s[s.AppNotConfiguredForWebPush=1]="AppNotConfiguredForWebPush",s[s.MissingSubdomain=2]="MissingSubdomain",s[s.WrongSiteUrl=3]="WrongSiteUrl",s[s.MultipleInitialization=4]="MultipleInitialization",s[s.MissingSafariWebId=5]="MissingSafariWebId",s[s.Unknown=6]="Unknown";var SdkInitError=function(e){function SdkInitError(n,r){var i=this;switch(n){case t.SdkInitErrorKind.InvalidAppId:i=e.call(this,"OneSignal: This app ID does match any existing app. Double check your app ID.")||this;break;case t.SdkInitErrorKind.AppNotConfiguredForWebPush:i=e.call(this,"OneSignal: This app ID does not have any web platforms enabled. Double check your app ID, or see step 1 on our setup guide (https://goo.gl/01h7fZ).")||this;break;case t.SdkInitErrorKind.MissingSubdomain:i=e.call(this,"OneSignal: Non-HTTPS pages require a subdomain of OneSignal to be chosen on your dashboard. See step 1.4 on our setup guide (https://goo.gl/xip6JB).")||this;break;case t.SdkInitErrorKind.WrongSiteUrl:i=r&&r.siteUrl?e.call(this,"OneSignal: This web push config can only be used on "+new URL(r.siteUrl).origin+". Your current origin is "+location.origin+".")||this:e.call(this,"OneSignal: This web push config can not be used on the current site.")||this;break;case t.SdkInitErrorKind.MultipleInitialization:i=e.call(this,"OneSignal: The OneSignal web SDK can only be initialized once. Extra initializations are ignored. Please remove calls initializing the SDK more than once.")||this;break;case t.SdkInitErrorKind.MissingSafariWebId:i=e.call(this,"OneSignal: Safari browser support on Mac OS X requires the Safari web platform to be enabled. Please see the Safari Support steps in our web setup guide.")||this;break;case t.SdkInitErrorKind.Unknown:i=e.call(this,"OneSignal: An unknown initialization error occurred.")||this}return i.reason=t.SdkInitErrorKind[n],Object.setPrototypeOf(i,SdkInitError.prototype),i}return i(SdkInitError,e),SdkInitError}(a.default);t.SdkInitError=SdkInitError},,function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._events={}}return e.prototype.on=function(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),this},e.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return r.listener=t,this.on(e,r),this},e.prototype.off=function(e,t){var n=this._events[e];if(void 0!==n){for(var r=0;r<n.length;r+=1)if(n[r]===t||n[r].listener===t){n.splice(r,1);break}0===n.length&&this.removeAllListeners(e)}return this},e.prototype.removeAllListeners=function(e){try{e?delete this._events[e]:this._events={}}catch(e){}return this},e.prototype.listeners=function(e){try{return this._events[e]}catch(e){return}},e.prototype.numberOfListeners=function(e){var t=this.listeners(e);return t?t.length:0},e.prototype.emit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,function(){var t,n,r,o;return i(this,function(i){switch(i.label){case 0:if(t=e.shift(),void 0===(n=this._events[t]))return[3,4];n=n.slice(0),r=n.length,o=0,i.label=1;case 1:return o<r?[4,n[o].apply(this,e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return o+=1,[3,1];case 4:return[2,this]}})})},e}();t.default=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(7)),a=o(n(9)),u=n(15),c=function(e){function t(t){var n=e.call(this)||this;return n.subscription=t,n}return i(t,e),t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.subscription&&(t.identifier=s.default.safari?this.subscription.safariDeviceToken:this.subscription.w3cEndpoint?this.subscription.w3cEndpoint.toString():null,t.web_auth=this.subscription.w3cAuth,t.web_p256=this.subscription.w3cP256dh),t},t.createFromPushSubscription=function(e,n,r){var i=new t(n);return i.appId=e,i.subscriptionState=n?u.SubscriptionStateKind.Subscribed:u.SubscriptionStateKind.NotSubscribed,r&&(i.subscriptionState=r),i},t.prototype.deserialize=function(e){throw new a.default},t}(n(25).DeviceRecord);t.PushDeviceRecord=c},,,function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(7)),o=r(n(5)),s=r(n(9)),a=n(33),u=n(58),c=n(1),l=function(){function e(){this.language=o.default.getLanguage(),this.timezone=-60*(new Date).getTimezoneOffset(),this.browserName=i.default.name,this.browserVersion=NaN!==parseInt(String(i.default.version))?parseInt(String(i.default.version)):-1,this.operatingSystem=this.getBrowserOperatingSystem(),this.operatingSystemVersion=String(i.default.osversion),this.devicePlatform=this.getDevicePlatform(),this.deviceModel=navigator.platform,this.sdkVersion=o.default.version().toString(),this.deliveryPlatform=this.getDeliveryPlatform()}return e.prototype.getDevicePlatform=function(){var e=i.default.mobile,t=i.default.tablet;return e?u.DevicePlatformKind.Mobile:t?u.DevicePlatformKind.Tablet:u.DevicePlatformKind.Desktop},e.prototype.isSafari=function(){return i.default.safari&&void 0!==window.safari&&void 0!==window.safari.pushNotification},e.prototype.getBrowserOperatingSystem=function(){return i.default.mac?"Mac OS X":i.default.windows?"Microsoft Windows":i.default.windowsphone?"Microsoft Windows Phone":i.default.linux?"Linux":i.default.chromeos?"Google Chrome OS":i.default.android?"Google Android":i.default.ios?"Apple iOS":i.default.blackberry?"Blackberry":i.default.firefoxos?"Mozilla Firefox OS":i.default.webos?"WebOS":i.default.tizen?"Tizen":i.default.sailfish?"Sailfish OS":"Unknown"},e.prototype.getDeliveryPlatform=function(){var e=c.redetectBrowserUserAgent();return this.isSafari()?a.DeliveryPlatformKind.Safari:e.firefox?a.DeliveryPlatformKind.Firefox:e.msedge?a.DeliveryPlatformKind.Edge:a.DeliveryPlatformKind.ChromeLike},e.prototype.serialize=function(){var e={device_type:this.deliveryPlatform,language:this.language,timezone:this.timezone,device_os:this.browserVersion,sdk:this.sdkVersion,notification_types:this.subscriptionState,delivery_platform:this.deliveryPlatform,browser_name:this.browserName,browser_version:this.browserVersion,operating_system:this.operatingSystem,operating_system_version:this.operatingSystemVersion,device_platform:this.devicePlatform,device_model:this.deviceModel};return this.appId&&(e.app_id=this.appId),e},e.prototype.deserialize=function(e){throw new s.default},e}();t.DeviceRecord=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(){}return e.getBaseUrl=function(){return location.origin},e.getValueOrDefault=function(e,t){return void 0!==e&&null!==e?e:t},e.isUsingSubscriptionWorkaround=function(){return r.isUsingSubscriptionWorkaround()},e}();t.Utils=i,t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.serialize=function(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}},e.deserialize=function(t){var n=new e;return n.deviceId=t.deviceId,n.subscriptionToken=t.subscriptionToken,n.optedOut=t.optedOut,n.createdAt=t.createdAt,n.expirationTime=t.expirationTime,n},e}();t.Subscription=r},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,u=n(50),c=s(n(10)),l=n(19),d=s(n(0)),f=n(3),p=n(1),h=s(n(26));(a=t.IntegrationConfigurationKind||(t.IntegrationConfigurationKind={}))[a.Dashboard=0]="Dashboard",a[a.JavaScript=1]="JavaScript";var g=function(){function e(){}return e.prototype.getAppConfig=function(t){return i(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:if(o.trys.push([0,2,,3]),!t||!t.appId||!p.isValidUuid(t.appId))throw new l.SdkInitError(l.SdkInitErrorKind.InvalidAppId);return[4,c.default.downloadServerAppConfig(t.appId)];case 1:return n=o.sent(),r=this.getMergedConfig(t,n),e.checkRestrictedOrigin(r),[2,r];case 2:if(i=o.sent()){if(1===i.code)throw new l.SdkInitError(l.SdkInitErrorKind.InvalidAppId);if(2===i.code)throw new l.SdkInitError(l.SdkInitErrorKind.AppNotConfiguredForWebPush)}throw i;case 3:return[2]}})})},e.checkRestrictedOrigin=function(t){if(t.restrictedOriginEnabled&&d.default.getWindowEnv()!==f.WindowEnvironmentKind.ServiceWorker&&window.top===window&&!p.contains(window.location.hostname,".os.tc")&&!p.contains(window.location.hostname,".onesignal.com")&&!e.doesCurrentOriginMatchConfigOrigin(t.origin))throw new l.SdkInitError(l.SdkInitErrorKind.WrongSiteUrl,{siteUrl:t.origin})},e.doesCurrentOriginMatchConfigOrigin=function(e){try{return location.origin===new URL(e).origin}catch(e){return!1}},e.prototype.getIntegrationCapabilities=function(e){switch(e){case u.ConfigIntegrationKind.Custom:case u.ConfigIntegrationKind.WordPress:return{configuration:t.IntegrationConfigurationKind.JavaScript};default:return{configuration:t.IntegrationConfigurationKind.Dashboard}}},e.prototype.getMergedConfig=function(e,t){var n=this.getConfigIntegrationKind(t);return{appId:t.app_id,subdomain:this.getSubdomainForConfigIntegrationKind(n,e,t),origin:t.config.origin,httpUseOneSignalCom:t.config.http_use_onesignal_com,cookieSyncEnabled:t.features.cookie_sync.enable,restrictedOriginEnabled:t.features.restrict_origin&&t.features.restrict_origin.enable,metrics:{enable:t.features.metrics.enable,mixpanelReportingToken:t.features.metrics.mixpanel_reporting_token},safariWebId:t.config.safari_web_id,vapidPublicKey:t.config.vapid_public_key,onesignalVapidPublicKey:t.config.onesignal_vapid_public_key,emailAuthRequired:t.features.email&&t.features.email.require_auth,userConfig:this.getUserConfigForConfigIntegrationKind(n,e,t)}},e.prototype.getConfigIntegrationKind=function(e){return e.config.integration?e.config.integration.kind:u.ConfigIntegrationKind.Custom},e.prototype.getCustomLinkConfig=function(e){var t={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(e&&e.config&&e.config.staticPrompts&&e.config.staticPrompts.customlink&&e.config.staticPrompts.customlink.enabled))return t;var n=e.config.staticPrompts.customlink;return{enabled:n.enabled,style:n.style,size:n.size,unsubscribeEnabled:n.unsubscribeEnabled,text:n.text?{subscribe:n.text.subscribe,unsubscribe:n.text.unsubscribe,explanation:n.text.explanation}:t.text,color:n.color?{button:n.color.button,text:n.color.text}:t.color}},e.prototype.injectDefaultsIntoPromptOptions=function(e,t){if(!e)return e;var n=e.customlink||{enabled:void 0,style:void 0,size:void 0,unsubscribeEnabled:void 0,text:void 0,color:void 0},i=t.customlink;return r({},e,{customlink:{enabled:h.default.getValueOrDefault(n.enabled,i.enabled),style:h.default.getValueOrDefault(n.style,i.style),size:h.default.getValueOrDefault(n.size,i.size),unsubscribeEnabled:h.default.getValueOrDefault(n.unsubscribeEnabled,i.unsubscribeEnabled),text:{subscribe:h.default.getValueOrDefault(n.text?n.text.subscribe:void 0,i.text.subscribe),unsubscribe:h.default.getValueOrDefault(n.text?n.text.unsubscribe:void 0,i.text.unsubscribe),explanation:h.default.getValueOrDefault(n.text?n.text.explanation:void 0,i.text.explanation)},color:{button:h.default.getValueOrDefault(n.color?n.color.button:void 0,i.color.button),text:h.default.getValueOrDefault(n.color?n.color.text:void 0,i.color.text)}}})},e.prototype.getUserConfigForConfigIntegrationKind=function(e,n,i){switch(this.getIntegrationCapabilities(e).configuration){case t.IntegrationConfigurationKind.Dashboard:return{appId:i.app_id,autoRegister:!1,path:i.config.serviceWorker.path,serviceWorkerPath:i.config.serviceWorker.workerName,serviceWorkerUpdaterPath:i.config.serviceWorker.updaterWorkerName,serviceWorkerParam:{scope:i.config.serviceWorker.registrationScope},subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:{slidedown:{autoPrompt:i.config.staticPrompts.slidedown.enabled,actionMessage:i.config.staticPrompts.slidedown.actionMessage,acceptButtonText:i.config.staticPrompts.slidedown.acceptButton,cancelButtonText:i.config.staticPrompts.slidedown.cancelButton},fullscreen:{actionMessage:i.config.staticPrompts.fullscreen.actionMessage,acceptButton:i.config.staticPrompts.fullscreen.acceptButton,cancelButton:i.config.staticPrompts.fullscreen.cancelButton,title:i.config.staticPrompts.fullscreen.title,message:i.config.staticPrompts.fullscreen.message,caption:i.config.staticPrompts.fullscreen.caption,autoAcceptTitle:i.config.staticPrompts.fullscreen.autoAcceptTitle},customlink:this.getCustomLinkConfig(i)},welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:i.config.staticPrompts.bell.hideWhenSubscribed?function(){return OneSignal.isPushNotificationsEnabled().then(function(e){return!e})}:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:i.config.staticPrompts.bell.offset.bottom+"px",left:i.config.staticPrompts.bell.offset.left+"px",right:i.config.staticPrompts.bell.offset.right+"px"},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior.display.persist,webhooks:{cors:i.config.webhooks.corsEnable,"notification.displayed":i.config.webhooks.notificationDisplayedHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior.click.match,notificationClickHandlerAction:i.config.notificationBehavior.click.action,allowLocalhostAsSecureOrigin:i.config.setupBehavior.allowLocalhostAsSecureOrigin,requiresUserPrivacyConsent:n.requiresUserPrivacyConsent};case t.IntegrationConfigurationKind.JavaScript:return r({},n,{promptOptions:this.injectDefaultsIntoPromptOptions(n.promptOptions,i.config.staticPrompts)},{serviceWorkerParam:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_PARAM?OneSignal.SERVICE_WORKER_PARAM:{scope:"/"},serviceWorkerPath:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_PATH?OneSignal.SERVICE_WORKER_PATH:"OneSignalSDKWorker.js",serviceWorkerUpdaterPath:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_UPDATER_PATH?OneSignal.SERVICE_WORKER_UPDATER_PATH:"OneSignalSDUpdaterKWorker.js",path:n.path?n.path:"/"})}},e.prototype.getSubdomainForConfigIntegrationKind=function(e,n,r){var i=this.getIntegrationCapabilities(e),o=n.subdomainName,s="";switch(i.configuration){case t.IntegrationConfigurationKind.Dashboard:s=r.config.siteInfo.proxyOriginEnabled?r.config.siteInfo.proxyOrigin:void 0;break;case t.IntegrationConfigurationKind.JavaScript:s=r.config.subdomain}return s&&!this.shouldUseServerConfigSubdomain(o,i)?void 0:s},e.prototype.shouldUseServerConfigSubdomain=function(e,n){switch(n.configuration){case t.IntegrationConfigurationKind.Dashboard:return!0;case t.IntegrationConfigurationKind.JavaScript:switch(location.protocol){case"https:":return!!e;case"http:":return!0;default:return!1}}},e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r},t.arrayBufferToBase64=function(e){for(var t,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(e),o=i.byteLength,s=o%3,a=o-s,u=0;u<a;u+=3)n+=r[(16515072&(t=i[u]<<16|i[u+1]<<8|i[u+2]))>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==s?n+=r[(252&(t=i[a]))>>2]+r[(3&t)<<4]+"==":2==s&&(n+=r[(64512&(t=i[a]<<8|i[a+1]))>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n},t.base64Encode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},t.base64Decode=function(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.isNewSubscription=function(){if(this.existingW3cPushSubscription){if(!!this.existingW3cPushSubscription.w3cEndpoint!=!!this.w3cEndpoint)return!1;if(this.existingW3cPushSubscription.w3cEndpoint&&this.w3cEndpoint&&this.existingW3cPushSubscription.w3cEndpoint.toString()!==this.w3cEndpoint.toString())return!1;if(this.existingW3cPushSubscription.w3cP256dh!==this.w3cP256dh)return!1;if(this.existingW3cPushSubscription.w3cAuth!==this.w3cAuth)return!1}else if(this.existingSafariDeviceToken)return this.existingSafariDeviceToken!==this.safariDeviceToken;return!0},e.setFromW3cSubscription=function(t){var n=new e;if(t&&(n.w3cEndpoint=new URL(t.endpoint),t.getKey)){var r=null;try{r=t.getKey("p256dh")}catch(e){}var i=null;try{i=t.getKey("auth")}catch(e){}if(r){var o=btoa(String.fromCharCode.apply(null,new Uint8Array(r)));n.w3cP256dh=o}if(i){var s=btoa(String.fromCharCode.apply(null,new Uint8Array(i)));n.w3cAuth=s}}return n},e.prototype.setFromSafariSubscription=function(e){this.safariDeviceToken=e},e.prototype.serialize=function(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken,existingPushSubscription:this.existingW3cPushSubscription?this.existingW3cPushSubscription.serialize():null,existingSafariDeviceToken:this.existingSafariDeviceToken}},e.deserialize=function(t){var n=new e;if(!t)return n;try{n.w3cEndpoint=new URL(t.w3cEndpoint)}catch(e){}return n.w3cP256dh=t.w3cP256dh,n.w3cAuth=t.w3cAuth,n.existingW3cPushSubscription=t.existingPushSubscription?e.deserialize(t.existingPushSubscription):null,n.safariDeviceToken=t.safariDeviceToken,n.existingSafariDeviceToken=t.existingSafariDeviceToken,n},e}();t.RawPushSubscription=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4));(s=t.SubscriptionErrorReason||(t.SubscriptionErrorReason={}))[s.InvalidSafariSetup=0]="InvalidSafariSetup",s[s.Blocked=1]="Blocked",s[s.Dismissed=2]="Dismissed";var u=function(e){function n(r){var i=this;switch(r){case t.SubscriptionErrorReason.InvalidSafariSetup:i=e.call(this,"The Safari site URL, icon size, or push certificate is invalid, or Safari is in a private session.")||this;break;case t.SubscriptionErrorReason.Blocked:i=e.call(this,"Notification permissions are blocked.")||this;break;case t.SubscriptionErrorReason.Dismissed:i=e.call(this,"The notification permission prompt was dismissed.")||this}return Object.setPrototypeOf(i,n.prototype),i}return i(n,e),n}(a.default);t.default=u},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),o=n(13),s=n(56),a=n(41),u=r(n(55)),c=r(n(37)),l=r(n(0)),d=n(54),f=r(n(53)),p=r(n(40)),h=function(){return function(e){this.appConfig=e,this.cookieSyncer=new u.default(this,e.cookieSyncEnabled),this.subscriptionManager=new s.SubscriptionManager(this,{safariWebId:e.safariWebId,appId:e.appId,vapidPublicKey:e.vapidPublicKey,onesignalVapidPublicKey:e.onesignalVapidPublicKey});var t={workerAPath:new c.default("/"+l.default.getBuildEnvPrefix()+"OneSignalSDKWorker.js"),workerBPath:new c.default("/"+l.default.getBuildEnvPrefix()+"OneSignalSDKUpdaterWorker.js"),registrationOptions:{scope:"/"}};e.userConfig&&(e.userConfig.path&&(t.workerAPath=new c.default(e.userConfig.path+l.default.getBuildEnvPrefix()+e.userConfig.serviceWorkerPath),t.workerBPath=new c.default(e.userConfig.path+l.default.getBuildEnvPrefix()+e.userConfig.serviceWorkerUpdaterPath)),e.userConfig.serviceWorkerParam&&(t.registrationOptions=e.userConfig.serviceWorkerParam)),this.serviceWorkerManager=new o.ServiceWorkerManager(this,t),this.workerMessenger=new i.WorkerMessenger(this),this.dynamicResourceLoader=new a.DynamicResourceLoader,this.sessionManager=new d.SessionManager,this.permissionManager=new f.default,this.metricsManager=new p.default(e.metrics.enable,e.metrics.mixpanelReportingToken)}}();t.default=h},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.DeliveryPlatformKind||(t.DeliveryPlatformKind={}))[r.ChromeLike=5]="ChromeLike",r[r.Safari=7]="Safari",r[r.Firefox=8]="Firefox",r[r.Edge=12]="Edge",r[r.Email=11]="Email"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(9)),a=n(33),u=function(e){function t(t,n,r){var i=e.call(this)||this;return i.email=t,i.emailAuthHash=n,i.pushDeviceRecordId=r,i.deliveryPlatform=a.DeliveryPlatformKind.Email,i}return i(t,e),t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.email&&(t.identifier=this.email),this.emailAuthHash&&(t.email_auth_hash=this.emailAuthHash),this.pushDeviceRecordId&&(t.device_player_id=this.pushDeviceRecordId),t},t.prototype.deserialize=function(e){throw new s.default},t}(n(25).DeviceRecord);t.EmailDeviceRecord=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(n,r){var i=e.call(this,"Registration of a Service Worker failed.")||this;return i.status=n,i.statusText=r,Object.setPrototypeOf(i,t.prototype),i}return i(t,e),t}(o(n(4)).default);t.ServiceWorkerRegistrationError=s,t.default=s},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=function(){function e(e){if(!e)throw new r.InvalidArgumentError("path",r.InvalidArgumentReason.Empty);this.path=e.trim()}return e.prototype.getQueryString=function(){var e=this.path.indexOf("?");return-1===e?null:this.path.length>e?this.path.substring(e+1):null},e.prototype.getWithoutQueryString=function(){return this.path.split(e.QUERY_STRING)[0]},e.prototype.getFileName=function(){return this.getWithoutQueryString().split("\\").pop().split("/").pop()},e.prototype.getFileNameWithQuery=function(){return this.path.split("\\").pop().split("/").pop()},e.prototype.getFullPath=function(){return this.path},e.prototype.getPathWithoutFileName=function(){var e=this.getWithoutQueryString(),t=e.lastIndexOf(this.getFileName()),n=e.substring(0,t);return n=n.replace(/[\\\/]$/,"")},e}();t.default=i,i.QUERY_STRING="?"},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.TestEnvironmentKind||(t.TestEnvironmentKind={})).None="None",r.UnitTesting="Unit Testing"},,function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,u=n(29),c=s(n(5)),l=function(){function e(){}return e.prototype.getPropertiesAsJson=function(){return{origin:location.origin,url:location.href,sdkVersion:c.default.version()}},e}(),d=function(){return function(){}}();(a=t.ApiUsageMetricKind||(t.ApiUsageMetricKind={})).HttpPermissionRequest="HttpPermissionRequest",a.SyncHashedEmail="SyncHashedEmail";var f=function(e){function t(t){var n=e.call(this)||this;return n.apiName=t,n}return i(t,e),t.prototype.getEventName=function(){return"api-usage"},t.prototype.getPropertiesAsJson=function(){return o({api:this.apiName.toString()},e.prototype.getPropertiesAsJson.call(this))},t}(l);t.ApiUsageMetricEvent=f;var p=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.getProfileName=function(){return"all_websites"},t.prototype.getDateUtc=function(){var e=new Date;return e.getUTCMonth()+1+"_"+e.getUTCDate()+"_"+e.getUTCFullYear()},t.prototype.getOperationData=function(){var e={$add:{},$ignore_time:!0};return e.$add["pageview_"+this.getDateUtc()]=1,e},t}(d);t.PageViewMetricEngagement=p;var h=function(){function e(e,t){this.isFeatureEnabled=e,this.mixpanelReportingToken=t}return Object.defineProperty(e,"MIXPANEL_REPORTING_URL",{get:function(){return"https://api.mixpanel.com"},enumerable:!0,configurable:!0}),e.prototype.isEnabled=function(){return this.isFeatureEnabled&&!!this.mixpanelReportingToken},e.prototype.reportEvent=function(t){if(!this.isEnabled())return Promise.resolve(null);var n={event:t.getEventName(),properties:o({token:this.mixpanelReportingToken},t.getPropertiesAsJson())},r=u.base64Encode(JSON.stringify(n)),i={method:"GET",headers:new Headers,cache:"no-cache"};return fetch(e.MIXPANEL_REPORTING_URL+"/track/?data="+r,i)},e.prototype.reportEngagement=function(t){if(!this.isEnabled())return Promise.resolve(null);var n={$token:this.mixpanelReportingToken,$distinct_id:t.getProfileName()};n=o({},n,t.getOperationData());var r=u.base64Encode(JSON.stringify(n)),i={method:"GET",headers:new Headers,cache:"no-cache"};return fetch(e.MIXPANEL_REPORTING_URL+"/engage/?data="+r,i)},e.prototype.shouldCollectPageView=function(){var e=new Date;return e.getUTCMonth()+1<=2&&e.getUTCDate()<=10&&e.getUTCFullYear()<=2018&&e.getUTCMonth()+1>=2&&e.getUTCDate()>=8&&e.getUTCFullYear()>=2018},e.prototype.reportPageView=function(){this.shouldCollectPageView()&&this.reportEngagement(new p)},e}();t.default=h},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(0)),u=s(n(5)),c=function(){function e(){this.cache={}}return e.prototype.getCache=function(){return r({},this.cache)},e.prototype.loadSdkStylesheet=function(){return i(this,void 0,void 0,function(){var e,t;return o(this,function(n){switch(n.label){case 0:return e=a.default.getOneSignalResourceUrlPath(),t=a.default.getOneSignalCssFileName(),[4,this.loadIfNew(0,new URL(e+"/"+t+"?v="+u.default.getSdkStylesVersionHash()))];case 1:return[2,n.sent()]}})})},e.prototype.loadFetchPolyfill=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.loadIfNew(1,new URL("https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"))];case 1:return[2,e.sent()]}})})},e.prototype.loadIfNew=function(t,n){return i(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return this.cache[n.toString()]||(this.cache[n.toString()]=e.load(t,n)),[4,this.cache[n.toString()]];case 1:return[2,r.sent()]}})})},e.load=function(e,t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,new Promise(function(n,r){switch(e){case 1:(i=document.createElement("script")).setAttribute("type","text/javascript"),i.setAttribute("async","async"),i.setAttribute("src",t.toString());break;case 0:var i;(i=document.createElement("link")).setAttribute("rel","stylesheet"),i.setAttribute("href",t.toString())}i.onerror=r,i.onload=n,document.querySelector("head").appendChild(i)})];case 1:return n.sent(),[2,0];case 2:return n.sent(),[2,1];case 3:return[2]}})})},e}();t.DynamicResourceLoader=c},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.serialize=function(){return{emailAddress:this.emailAddress,emailAuthHash:this.emailAuthHash,emailId:this.emailId}},e.deserialize=function(t){var n=new e;return n.emailId=t.emailId,n.emailAddress=t.emailAddress,n.emailAuthHash=t.emailAuthHash,n},e}();t.EmailProfile=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(21)),a=n(1),u=o(n(2)),c=function(){function e(e){this.databaseName=e,this.emitter=new s.default}return e.prototype.open=function(e){var t=this;return new Promise(function(n){try{var r=indexedDB.open(e,1)}catch(e){}if(!r)return null;r.onerror=t.onDatabaseOpenError,r.onblocked=t.onDatabaseOpenBlocked,r.onupgradeneeded=t.onDatabaseUpgradeNeeded,r.onsuccess=function(){t.database=r.result,t.database.onerror=t.onDatabaseError,t.database.onversionchange=t.onDatabaseVersionChange,n(t.database)}})},e.prototype.ensureDatabaseOpen=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.openLock||(this.openLock=this.open(this.databaseName)),[4,this.openLock];case 1:return e.sent(),[2,this.database]}})})},e.prototype.onDatabaseOpenError=function(e){e.preventDefault();var t=e.target.error;a.contains(t.message,"The operation failed for reasons unrelated to the database itself and not covered by any other error code")||a.contains(t.message,"A mutation operation was attempted on a database that did not allow mutations")?u.default.warn("OneSignal: IndexedDb web storage is not available on this origin since this profile's IndexedDb schema has been upgraded in a newer version of Firefox. See: https://bugzilla.mozilla.org/show_bug.cgi?id=1236557#c6"):u.default.warn("OneSignal: Fatal error opening IndexedDb database:",t)},e.prototype.onDatabaseError=function(e){u.default.debug("IndexedDb: Generic database error",e.target.errorCode)},e.prototype.onDatabaseOpenBlocked=function(){u.default.debug("IndexedDb: Blocked event")},e.prototype.onDatabaseVersionChange=function(e){u.default.debug("IndexedDb: versionchange event")},e.prototype.onDatabaseUpgradeNeeded=function(e){u.default.debug("IndexedDb: Database is being rebuilt or upgraded (upgradeneeded event).");var t=e.target.result;t.createObjectStore("Ids",{keyPath:"type"}),t.createObjectStore("NotificationOpened",{keyPath:"url"}),t.createObjectStore("Options",{keyPath:"key"}),"undefined"!=typeof OneSignal&&(OneSignal._isNewVisitor=!0)},e.prototype.get=function(e,t){return r(this,void 0,void 0,function(){var n=this;return i(this,function(r){switch(r.label){case 0:return[4,this.ensureDatabaseOpen()];case 1:return r.sent(),t?[4,new Promise(function(r,i){var o=n.database.transaction(e).objectStore(e).get(t);o.onsuccess=function(){r(o.result)},o.onerror=function(){i(o.error)}})]:[3,3];case 2:return[2,r.sent()];case 3:return[4,new Promise(function(t,r){var i={},o=n.database.transaction(e).objectStore(e).openCursor();o.onsuccess=function(e){var n=e.target.result;if(n){var r=n.key;i[r]=n.value,n.continue()}else t(i)},o.onerror=function(){r(o.error)}})];case 4:return[2,r.sent()]}})})},e.prototype.put=function(e,t){return r(this,void 0,void 0,function(){var n=this;return i(this,function(r){switch(r.label){case 0:return[4,this.ensureDatabaseOpen()];case 1:return r.sent(),[4,new Promise(function(r,i){try{var o=n.database.transaction([e],"readwrite").objectStore(e).put(t);o.onsuccess=function(){r(t)},o.onerror=function(e){u.default.error("Database PUT Transaction Error:",e),i(e)}}catch(e){u.default.error("Database PUT Error:",e),i(e)}})];case 2:return[2,r.sent()]}})})},e.prototype.remove=function(e,t){var n=this;if(t)var r="delete";else r="clear";return new Promise(function(i,o){try{var s=n.database.transaction([e],"readwrite").objectStore(e)[r](t);s.onsuccess=function(){i(t)},s.onerror=function(e){u.default.error("Database REMOVE Transaction Error:",e),o(e)}}catch(e){u.default.error("Database REMOVE Error:",e),o(e)}})},e}();t.default=c},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.PermissionPromptType||(t.PermissionPromptType={}))[r.HttpsPermissionRequest="HTTPS permission request"]="HttpsPermissionRequest",r[r.FullscreenHttpPermissionMessage="fullscreen HTTP permission message"]="FullscreenHttpPermissionMessage",r[r.FullscreenHttpsPermissionMessage="fullscreen HTTPS permission message"]="FullscreenHttpsPermissionMessage",r[r.SlidedownPermissionMessage="slidedown permission message"]="SlidedownPermissionMessage",r[r.SubscriptionBell="subscription bell"]="SubscriptionBell"},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.BuildEnvironmentKind||(t.BuildEnvironmentKind={})).Development="Development",r.Staging="Staging",r.Production="Production"},function(e,t,n){"use strict";(function(e){var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=s(n(7)),u=s(n(5)),c=n(17),l=s(n(0)),d=s(n(32)),f=s(n(10)),p=s(n(8)),h=n(1),g=s(n(28)),v=n(30),b=n(15),m=n(22),w=s(n(2)),S=function(){function e(){}return Object.defineProperty(e,"VERSION",{get:function(){return u.default.version()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"environment",{get:function(){return u.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"log",{get:function(){return w.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"database",{get:function(){return p.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sdkEnvironment",{get:function(){return l.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"browser",{get:function(){return a.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"workerMessenger",{get:function(){return self.workerMessenger||(self.workerMessenger=new c.WorkerMessenger(null)),self.workerMessenger},enumerable:!0,configurable:!0}),e.run=function(){self.addEventListener("push",e.onPushReceived),self.addEventListener("notificationclose",e.onNotificationClosed),self.addEventListener("notificationclick",function(t){return t.waitUntil(e.onNotificationClicked(t))}),self.addEventListener("install",e.onServiceWorkerInstalled),self.addEventListener("activate",e.onServiceWorkerActivated),self.addEventListener("pushsubscriptionchange",function(t){t.waitUntil(e.onPushSubscriptionChange(t))}),w.default.debug("Setting up message listeners."),e.workerMessenger.listen(),e.setupMessageListeners()},e.getAppId=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return self.location.search?[2,self.location.search.match(/appId=([0-9a-z-]+)&?/i)[1]]:[3,1];case 1:return[4,p.default.getAppConfig()];case 2:return[2,e.sent().appId]}})})},e.setupMessageListeners=function(){var t=this;e.workerMessenger.on(c.WorkerMessengerCommand.WorkerVersion,function(t){w.default.debug("[Service Worker] Received worker version message."),e.workerMessenger.broadcast(c.WorkerMessengerCommand.WorkerVersion,u.default.version())}),e.workerMessenger.on(c.WorkerMessengerCommand.Subscribe,function(n){return i(t,void 0,void 0,function(){var t,r,i,s;return o(this,function(o){switch(o.label){case 0:return t=n,w.default.debug("[Service Worker] Received subscribe message."),[4,(r=new d.default(t)).subscriptionManager.subscribe(0)];case 1:return i=o.sent(),[4,r.subscriptionManager.registerSubscription(i)];case 2:return s=o.sent(),e.workerMessenger.broadcast(c.WorkerMessengerCommand.Subscribe,s.serialize()),[2]}})})}),e.workerMessenger.on(c.WorkerMessengerCommand.SubscribeNew,function(n){return i(t,void 0,void 0,function(){var t,r,i,s;return o(this,function(o){switch(o.label){case 0:return t=n,w.default.debug("[Service Worker] Received subscribe new message."),[4,(r=new d.default(t)).subscriptionManager.subscribe(1)];case 1:return i=o.sent(),[4,r.subscriptionManager.registerSubscription(i)];case 2:return s=o.sent(),e.workerMessenger.broadcast(c.WorkerMessengerCommand.SubscribeNew,s.serialize()),[2]}})})}),e.workerMessenger.on(c.WorkerMessengerCommand.AmpSubscriptionState,function(n){return i(t,void 0,void 0,function(){var t,n,r,i;return o(this,function(o){switch(o.label){case 0:return w.default.debug("[Service Worker] Received AMP subscription state message."),[4,self.registration.pushManager.getSubscription()];case 1:return(t=o.sent())?[3,2]:(e.workerMessenger.broadcast(c.WorkerMessengerCommand.AmpSubscriptionState,!1),[3,5]);case 2:return[4,self.registration.pushManager.permissionState(t.options)];case 3:return n=o.sent(),[4,p.default.getSubscription()];case 4:r=o.sent().optedOut,i=!!t&&"granted"===n&&!0!==r,e.workerMessenger.broadcast(c.WorkerMessengerCommand.AmpSubscriptionState,i),o.label=5;case 5:return[2]}})})}),e.workerMessenger.on(c.WorkerMessengerCommand.AmpSubscribe,function(){return i(t,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:return w.default.debug("[Service Worker] Received AMP subscribe message."),[4,e.getAppId()];case 1:return t=o.sent(),[4,(new g.default).getAppConfig({appId:t})];case 2:return n=o.sent(),[4,(r=new d.default(n)).subscriptionManager.subscribe(0)];case 3:return i=o.sent(),[4,r.subscriptionManager.registerSubscription(i)];case 4:return s=o.sent(),e.workerMessenger.broadcast(c.WorkerMessengerCommand.AmpSubscribe,s.deviceId),[2]}})})}),e.workerMessenger.on(c.WorkerMessengerCommand.AmpUnsubscribe,function(){return i(t,void 0,void 0,function(){var t,n;return o(this,function(r){switch(r.label){case 0:return w.default.debug("[Service Worker] Received AMP unsubscribe message."),[4,e.getAppId()];case 1:return t=r.sent(),[4,(new g.default).getAppConfig({appId:t})];case 2:return n=r.sent(),[4,new d.default(n).subscriptionManager.unsubscribe(1)];case 3:return r.sent(),e.workerMessenger.broadcast(c.WorkerMessengerCommand.AmpUnsubscribe,null),[2]}})})})},e.onPushReceived=function(t){w.default.debug("Called %conPushReceived("+JSON.stringify(t,null,4)+"):",h.getConsoleStyle("code"),t),t.waitUntil(e.parseOrFetchNotifications(t).then(function(t){if(!t||0==t.length)return w.default.debug("Because no notifications were retrieved, we'll display the last known notification, so long as it isn't the welcome notification."),e.displayBackupNotification();for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];w.default.debug("Raw Notification from OneSignal:",o);var s=e.buildStructuredNotificationObject(o);n.push(function(t){return e.displayNotification(t).then(function(){return e.updateBackupNotification(t).catch(function(e){return w.default.error(e)})}).then(function(){return e.workerMessenger.broadcast(c.WorkerMessengerCommand.NotificationDisplayed,t).catch(function(e){return w.default.error(e)})}).then(function(){return e.executeWebhooks("notification.displayed",t).catch(function(e){return w.default.error(e)})})}.bind(null,s))}return n.reduce(function(e,t){return e.then(t)},Promise.resolve())}).catch(function(t){return w.default.debug("Failed to display a notification:",t),e.UNSUBSCRIBED_FROM_NOTIFICATIONS?void w.default.debug("Because we have just unsubscribed from notifications, we will not show anything."):(w.default.debug("Because a notification failed to display, we'll display the last known notification, so long as it isn't the welcome notification."),e.displayBackupNotification())}))},e.executeWebhooks=function(e,t){return i(this,void 0,void 0,function(){var n,r,i,s,a;return o(this,function(o){switch(o.label){case 0:return[4,p.default.getSubscription()];case 1:return n=o.sent().deviceId,[4,p.default.get("Options","webhooks.cors")];case 2:return r=o.sent(),[4,p.default.get("Options","webhooks."+e)];case 3:return(i=o.sent())?(s={event:e,id:t.id,userId:n,action:t.action,buttons:t.buttons,heading:t.heading,content:t.content,url:t.url,icon:t.icon,data:t.data},a={method:"post",mode:"no-cors",body:JSON.stringify(s)},r&&(a.mode="cors",a.headers={"X-OneSignal-Event":e,"Content-Type":"application/json"}),w.default.debug("Executing "+e+" webhook "+(r?"with":"without")+" CORS %cPOST "+i,h.getConsoleStyle("code"),":",s),[4,fetch(i,a)]):[3,5];case 4:return[2,o.sent()];case 5:return[2]}})})},e.getActiveClients=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i;return o(this,function(o){switch(o.label){case 0:return[4,self.clients.matchAll({type:"window",includeUncontrolled:!0})];case 1:for(e=o.sent(),t=[],n=0,r=e;n<r.length;n++){if((i=r[n]).frameType&&"nested"===i.frameType){if(!h.contains(i.url,l.default.getOneSignalApiUrl().host)&&!h.contains(i.url,".os.tc"))continue;i.isSubdomainIframe=!0}t.push(i)}return[2,t]}})})},e.buildStructuredNotificationObject=function(e){var t={id:e.custom.i,heading:e.title,content:e.alert,data:e.custom.a,url:e.custom.u,icon:e.icon,image:e.image,tag:e.tag,badge:e.badge,vibrate:e.vibrate};if(e.o){t.buttons=[];for(var n=0,r=e.o;n<r.length;n++){var i=r[n];t.buttons.push({action:i.i,title:i.n,icon:i.p,url:i.u})}}return h.trimUndefined(t)},e.ensureImageResourceHttps=function(e){if(!e)return null;try{var t=new URL(e);return"localhost"===t.hostname||-1!==t.hostname.indexOf("192.168")||"127.0.0.1"===t.hostname||"https:"===t.protocol?e:"i0.wp.com"===t.hostname||"i1.wp.com"===t.hostname||"i2.wp.com"===t.hostname||"i3.wp.com"===t.hostname?"https://"+t.hostname+t.pathname:"https://i0.wp.com/"+(t.host+t.pathname)}catch(e){}},e.ensureNotificationResourcesHttps=function(t){if(t&&(t.icon&&(t.icon=e.ensureImageResourceHttps(t.icon)),t.image&&(t.image=e.ensureImageResourceHttps(t.image)),t.buttons&&t.buttons.length>0))for(var n=0,r=t.buttons;n<r.length;n++){var i=r[n];i.icon&&(i.icon=e.ensureImageResourceHttps(i.icon))}},e.displayNotification=function(t,n){return i(this,void 0,void 0,function(){var i,s,a,u,c,l;return o(this,function(o){switch(o.label){case 0:return w.default.debug("Called %cdisplayNotification("+JSON.stringify(t,null,4)+"):",h.getConsoleStyle("code"),t),[4,e._getTitle()];case 1:return i=o.sent(),[4,p.default.get("Options","defaultIcon")];case 2:return s=o.sent(),[4,p.default.get("Options","persistNotification")];case 3:return a=o.sent(),[4,e.getAppId()];case 4:return u=o.sent(),t.heading=t.heading?t.heading:i,t.icon=t.icon?t.icon:s||void 0,(c={}).tag=t.tag||u,c.persistNotification="force"===a||a,n||(n={}),t=r({},t,n),e.ensureNotificationResourcesHttps(t),l={body:t.content,icon:t.icon,image:t.image,data:t,actions:t.buttons,tag:c.tag,requireInteraction:c.persistNotification,renotify:!0,badge:t.badge,vibrate:t.vibrate},l=e.filterNotificationOptions(l,"force"===a),[2,self.registration.showNotification(t.heading,l)]}})})},e.filterNotificationOptions=function(e,t){if("object"!=typeof e)return e;var n=r({},e);if(""===a.default.name&&""===a.default.version)var i=a.default._detect(navigator.userAgent);else i=a.default;return i.chrome&&i.mac&&n&&(n.requireInteraction=!1),t&&(n.requireInteraction=!0),n},e.updateBackupNotification=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return e.data&&e.data.__isOneSignalWelcomeNotification?[2]:[4,p.default.put("Ids",{type:"backupNotification",id:e})];case 1:return t.sent(),[2]}})})},e.displayBackupNotification=function(){return p.default.get("Ids","backupNotification").then(function(t){var n={persistNotification:!1,data:{__isOneSignalBackupNotification:!0}};return t?e.displayNotification(t,n):e.displayNotification({content:"You have new updates."},n)})},e.shouldOpenNotificationUrl=function(e){return"javascript:void(0);"!==e&&"do_not_open"!==e&&!h.contains(e,"_osp=do_not_open")},e.onNotificationClosed=function(t){w.default.debug("Called %conNotificationClosed("+JSON.stringify(t,null,4)+"):",h.getConsoleStyle("code"),t);var n=t.notification.data;e.workerMessenger.broadcast(c.WorkerMessengerCommand.NotificationDismissed,n).catch(function(e){return w.default.error(e)}),t.waitUntil(e.executeWebhooks("notification.dismissed",n))},e.getNotificationUrlToOpen=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s;return o(this,function(o){switch(o.label){case 0:return t=self.registration.scope,[4,p.default.getAppState()];case 1:if((n=o.sent().defaultNotificationUrl)&&(t=n),e.action)for(r=0,i=e.buttons;r<i.length;r++)(s=i[r]).action===e.action&&s.url&&""!==s.url&&(t=s.url);else e.url&&""!==e.url&&(t=e.url);return[2,t]}})})},e.onNotificationClicked=function(t){return i(this,void 0,void 0,function(){var n,r,i,s,a,u,l,d,g,v,b,m,S,y,k,P,_,O,E,I,x,W;return o(this,function(o){switch(o.label){case 0:return w.default.debug("Called %conNotificationClicked("+JSON.stringify(t,null,4)+"):",h.getConsoleStyle("code"),t),t.notification.close(),n=t.notification.data,t.action&&(n.action=t.action),r="exact",i="navigate",[4,p.default.get("Options","notificationClickHandlerMatch")];case 1:return(s=o.sent())&&(r=s),[4,this.database.get("Options","notificationClickHandlerAction")];case 2:return(a=o.sent())&&(i=a),[4,e.getActiveClients()];case 3:return u=o.sent(),[4,e.getNotificationUrlToOpen(n)];case 4:l=o.sent(),d=e.shouldOpenNotificationUrl(l),g=!1,v=0,b=u,o.label=5;case 5:return v<b.length?(m=b[v],S=m.url,m.isSubdomainIframe?[4,p.default.get("Options","lastKnownHostUrl")]:[3,8]):[3,37];case 6:return y=o.sent(),S=y,y?[3,8]:[4,p.default.get("Options","defaultUrl")];case 7:S=o.sent(),o.label=8;case 8:k="";try{k=new URL(S).origin}catch(e){w.default.error("Failed to get the HTTP site's actual origin:",e)}P=null;try{P=new URL(l).origin}catch(e){}if(!("exact"===r&&S===l||"origin"===r&&k===P))return[3,36];if(!(m.isSubdomainIframe&&S===l||!m.isSubdomainIframe&&m.url===l||"focus"===i&&k===P))return[3,13];e.workerMessenger.unicast(c.WorkerMessengerCommand.NotificationClicked,n,m),o.label=9;case 9:return o.trys.push([9,11,,12]),[4,m.focus()];case 10:return o.sent(),[3,12];case 11:return _=o.sent(),w.default.error("Failed to focus:",m,_),[3,12];case 12:return[3,35];case 13:if(!m.isSubdomainIframe)return[3,21];o.label=14;case 14:return o.trys.push([14,16,,17]),w.default.debug("Client is subdomain iFrame. Attempting to focus() client."),[4,m.focus()];case 15:return o.sent(),[3,17];case 16:return O=o.sent(),w.default.error("Failed to focus:",m,O),[3,17];case 17:return d?(w.default.debug("Redirecting HTTP site to "+l+"."),[4,p.default.put("NotificationOpened",{url:l,data:n,timestamp:Date.now()})]):[3,19];case 18:return o.sent(),e.workerMessenger.unicast(c.WorkerMessengerCommand.RedirectPage,l,m),[3,20];case 19:w.default.debug("Not navigating because link is special."),o.label=20;case 20:return[3,35];case 21:if(!m.navigate)return[3,32];o.label=22;case 22:return o.trys.push([22,24,,25]),w.default.debug("Client is standard HTTPS site. Attempting to focus() client."),[4,m.focus()];case 23:return o.sent(),[3,25];case 24:return E=o.sent(),w.default.error("Failed to focus:",m,E),[3,25];case 25:return o.trys.push([25,30,,31]),d?(w.default.debug("Redirecting HTTPS site to ("+l+")."),[4,p.default.put("NotificationOpened",{url:l,data:n,timestamp:Date.now()})]):[3,28];case 26:return o.sent(),[4,m.navigate(l)];case 27:return o.sent(),[3,29];case 28:w.default.debug("Not navigating because link is special."),o.label=29;case 29:return[3,31];case 30:return I=o.sent(),w.default.error("Failed to navigate:",m,l,I),[3,31];case 31:return[3,35];case 32:return[4,p.default.put("NotificationOpened",{url:l,data:n,timestamp:Date.now()})];case 33:return o.sent(),[4,e.openUrl(l)];case 34:o.sent(),o.label=35;case 35:return g=!0,[3,37];case 36:return v++,[3,5];case 37:return!d||g?[3,40]:[4,p.default.put("NotificationOpened",{url:l,data:n,timestamp:Date.now()})];case 38:return o.sent(),[4,e.openUrl(l)];case 39:o.sent(),o.label=40;case 40:return[4,p.default.getAppConfig()];case 41:return x=o.sent().appId,[4,p.default.getSubscription()];case 42:return W=o.sent().deviceId,x&&W?[4,f.default.put("notifications/"+n.id,{app_id:x,player_id:W,opened:!0})]:[3,44];case 43:o.sent(),o.label=44;case 44:return[4,e.executeWebhooks("notification.clicked",n)];case 45:return[2,o.sent()]}})})},e.openUrl=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:w.default.debug("Opening notification URL:",e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,self.clients.openWindow(e)];case 2:return[2,n.sent()];case 3:return t=n.sent(),w.default.warn("Failed to open the URL '"+e+"':",t),[2,void 0];case 4:return[2]}})})},e.onServiceWorkerInstalled=function(e){e.waitUntil(self.skipWaiting())},e.onServiceWorkerActivated=function(e){w.default.info("%cOneSignal Service Worker activated (version "+u.default.version()+", "+l.default.getWindowEnv().toString()+" environment).",h.getConsoleStyle("bold")),e.waitUntil(self.clients.claim())},e.onPushSubscriptionChange=function(t){return i(this,void 0,void 0,function(){var n,r,i,s,a,u,c,l,S;return o(this,function(o){switch(o.label){case 0:return w.default.debug("Called %conPushSubscriptionChange("+JSON.stringify(t,null,4)+"):",h.getConsoleStyle("code"),t),[4,e.getAppId()];case 1:return(n=o.sent())?[4,(new g.default).getAppConfig({appId:n})]:[2];case 2:return(r=o.sent())?(i=new d.default(r),[4,p.default.getSubscription()]):[2];case 3:return a=o.sent().deviceId,(s=!!a)||!t.oldSubscription?[3,7]:[4,f.default.getUserIdFromSubscriptionIdentifier(n,m.PushDeviceRecord.prototype.getDeliveryPlatform(),t.oldSubscription.endpoint)];case 4:return a=o.sent(),[4,p.default.getSubscription()];case 5:return(u=o.sent()).deviceId=a,[4,p.default.setSubscription(u)];case 6:o.sent(),o.label=7;case 7:return s=!!a,(l=t.newSubscription)?(c=v.RawPushSubscription.setFromW3cSubscription(l),[3,11]):[3,8];case 8:return o.trys.push([8,10,,11]),[4,i.subscriptionManager.subscribe(1)];case 9:return c=o.sent(),[3,11];case 10:return o.sent(),[3,11];case 11:return s||!!c?[3,14]:[4,p.default.remove("Ids","userId")];case 12:return o.sent(),[4,p.default.remove("Ids","registrationId")];case 13:return o.sent(),[3,17];case 14:return S=null,[4,navigator.permissions.query({name:"push",userVisibleOnly:!0})];case 15:return"granted"!==o.sent()?S=b.SubscriptionStateKind.PermissionRevoked:c||(S=b.SubscriptionStateKind.PushSubscriptionRevoked),[4,i.subscriptionManager.registerSubscription(c,S)];case 16:o.sent(),o.label=17;case 17:return[2]}})})},e._getTitle=function(){return new Promise(function(e){Promise.all([p.default.get("Options","defaultTitle"),p.default.get("Options","pageTitle")]).then(function(t){var n=t[0],r=t[1];e(null!==n?n:null!=r?r:"")})})},e.parseOrFetchNotifications=function(t){return t.data?e.isValidPushPayload(t.data)?(w.default.debug("Received a valid encrypted push payload."),Promise.resolve([t.data.json()])):Promise.reject("Unexpected push message payload received: "+t.data.text()):e.retrieveNotifications()},e.isValidPushPayload=function(e){try{var t=e.json();return!!(t&&t.custom&&t.custom.i&&h.isValidUuid(t.custom.i))||(w.default.debug("isValidPushPayload: Valid JSON but missing notification UUID:",t),!1)}catch(e){return w.default.debug("isValidPushPayload: Parsing to JSON failed with:",e),!1}},e.retrieveNotifications=function(){return new Promise(function(t){var n=[];p.default.get("Ids","userId").then(function(t){return t?(w.default.debug("Legacy push signal received, retrieving contents from players/"+t+"/chromeweb_notification"),f.default.get("players/"+t+"/chromeweb_notification")):(w.default.debug("Tried to get notification contents, but IndexedDB is missing user ID info."),Promise.all([e.getAppId(),self.registration.pushManager.getSubscription().then(function(e){return e.endpoint})]).then(function(e){var t=e[0],n=e[1],r=m.PushDeviceRecord.prototype.getDeliveryPlatform();return f.default.getUserIdFromSubscriptionIdentifier(t,r,n).then(function(e){return e?(w.default.debug("Recovered OneSignal user ID:",e),Promise.all([p.default.put("Ids",{type:"userId",id:e}),p.default.put("Ids",{type:"registrationId",id:n.replace(new RegExp("^(https://android.googleapis.com/gcm/send/|https://updates.push.services.mozilla.com/push/)"),"")})]).then(function(){return w.default.debug("Attempting to retrieve the notification again now with a recovered user ID."),f.default.get("players/"+e+"/chromeweb_notification")})):Promise.reject("Recovered user ID was null. Unsubscribing from push notifications.")})}).catch(function(t){return w.default.debug("Unsuccessfully attempted to recover OneSignal user ID:",t),self.registration.pushManager.getSubscription().then(function(e){return e.unsubscribe()}).then(function(t){w.default.debug("Unsubscribed from push notifications result:",t),e.UNSUBSCRIBED_FROM_NOTIFICATIONS=!0})}))}).then(function(e){for(var r=0;r<e.length;r++)n.push(JSON.parse(e[r]));0==n.length&&w.default.warn("OneSignal Worker: Received a GCM push signal, but there were no messages to retrieve. Are you using the wrong API URL?",l.default.getOneSignalApiUrl().toString()),t(n)})})},e}();t.ServiceWorker=S,"undefined"==typeof self&&void 0!==e?e.OneSignalWorker=S:self.OneSignalWorker=S,"undefined"!=typeof self&&S.run()}).call(this,n(36))},,function(e,t,n){"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ConfigIntegrationKind||(t.ConfigIntegrationKind={})).TypicalSite="typical",r.WordPress="wordpress",r.Shopify="shopify",r.Blogger="blogger",r.Magento="magento",r.Drupal="drupal",r.SquareSpace="squarespace",r.Joomla="joomla",r.Weebly="weebly",r.Wix="wix",r.Custom="custom",(i=t.NotificationClickMatchBehavior||(t.NotificationClickMatchBehavior={})).Exact="exact",i.Origin="origin",(o=t.NotificationClickActionBehavior||(t.NotificationClickActionBehavior={})).Navigate="navigate",o.Focus="focus"},,,function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=o(n(7)),u=n(14),c=o(n(8)),l=n(16),d=o(n(0)),f=function(){function e(){}return Object.defineProperty(e,"STORED_PERMISSION_KEY",{get:function(){return"storedNotificationPermission"},enumerable:!0,configurable:!0}),e.prototype.getNotificationPermission=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return[4,this.getReportedNotificationPermission(e)];case 1:return t=n.sent(),[4,this.isPermissionEnvironmentAmbiguous(t)];case 2:return n.sent()?[4,this.getInterpretedAmbiguousPermission(t)]:[3,4];case 3:return[2,n.sent()];case 4:return[2,t]}})})},e.prototype.getReportedNotificationPermission=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return a.default.safari?[2,e.getSafariNotificationPermission(t)]:s.isUsingSubscriptionWorkaround()?[4,this.getOneSignalSubdomainNotificationPermission(t)]:[3,2];case 1:return[2,n.sent()];case 2:return[2,this.getW3cNotificationPermission()]}})})},e.getSafariNotificationPermission=function(e){if(e)return window.safari.pushNotification.permission(e).permission;throw new u.InvalidArgumentError("safariWebId",u.InvalidArgumentReason.Empty)},e.prototype.getW3cNotificationPermission=function(){return window.Notification.permission},e.prototype.getOneSignalSubdomainNotificationPermission=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,new Promise(function(t){OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION,{safariWebId:e},function(e){var n=e.data;t(n)})})]})})},e.prototype.isPermissionEnvironmentAmbiguous=function(e){return r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return t=s.redetectBrowserUserAgent(),(n=!t.safari&&!t.firefox&&e===l.NotificationPermission.Denied)?(r=this.isCurrentFrameContextCrossOrigin())?[3,2]:[4,d.default.isFrameContextInsecure()]:[3,3];case 1:r=i.sent(),i.label=2;case 2:n=r||s.isUsingSubscriptionWorkaround()||d.default.isInsecureOrigin(),i.label=3;case 3:return[2,n]}})})},e.prototype.isCurrentFrameContextCrossOrigin=function(){var e;try{e=window.top.location.origin}catch(e){return!0}return window.top!==window&&e!==window.location.origin},e.prototype.getInterpretedAmbiguousPermission=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:switch(e){case l.NotificationPermission.Denied:return[3,1]}return[3,3];case 1:return[4,this.getStoredPermission()];case 2:return(t=n.sent())?[2,t]:[2,l.NotificationPermission.Default];case 3:return[2,e]}})})},e.prototype.getStoredPermission=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,c.default.get("Options",e.STORED_PERMISSION_KEY)];case 1:return[2,t.sent()]}})})},e.prototype.setStoredPermission=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,c.default.put("Options",{key:e.STORED_PERMISSION_KEY,value:t})];case 1:return n.sent(),[2]}})})},e.prototype.updateStoredPermission=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.getNotificationPermission(null)];case 1:return e=t.sent(),[4,this.setStoredPermission(e)];case 2:return[2,t.sent()]}})})},e}();t.default=f},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=n(3),s=r(n(2)),a=function(){function e(){}return e.prototype.getPageViewCount=function(){try{var t=sessionStorage.getItem(e.SESSION_STORAGE_KEY_NAME),n=parseInt(t);return isNaN(n)?0:n}catch(e){return 0}},e.prototype.setPageViewCount=function(t){try{sessionStorage.setItem(e.SESSION_STORAGE_KEY_NAME,t.toString()),i.default.getWindowEnv()===o.WindowEnvironmentKind.OneSignalSubscriptionPopup&&OneSignal.subscriptionPopup&&OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT)}catch(e){}},e.prototype.incrementPageViewCount=function(){if(!this.incrementedPageViewCount){var e=this.getPageViewCount()+1;this.setPageViewCount(e),s.default.debug("Incremented page view count to "+e+"."),this.incrementedPageViewCount=!0}},e.prototype.simulatePageNavigationOrRefresh=function(){this.incrementedPageViewCount=!1},e.prototype.isFirstPageView=function(){return 1===this.getPageViewCount()},e}();t.SessionManager=a,a.SESSION_STORAGE_KEY_NAME="onesignal-pageview-count"},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(0)),a=function(){function e(e,t){this.context=e,this.isFeatureEnabled=t}return Object.defineProperty(e.prototype,"PUBLISHER_ID",{get:function(){try{return"os!"+this.context.appConfig.appId.replace(/-/g,"").substr(0,15).toLowerCase()}catch(e){return"os!os"}},enumerable:!0,configurable:!0}),e.prototype.getFrameOrigin=function(){return!!this.context.appConfig.subdomain?new URL("https://"+this.context.appConfig.subdomain+".os.tc"):new URL(s.default.getOneSignalApiUrl().origin)},e.prototype.install=function(){return r(this,void 0,void 0,function(){var e,t,n;return i(this,function(r){return window.top!==window?[2]:(e=this.getFrameOrigin(),this.isFeatureEnabled?(e.pathname="/webPushAnalytics",e.search="sync=true&appId="+this.PUBLISHER_ID):e.pathname="/webPushAnalytics",(t=document.createElement("iframe")).style.display="none",t.src=e.href,(n={promise:void 0,resolver:void 0,rejector:void 0}).promise=new Promise(function(e,t){n.resolver=e,n.rejector=t}),document.body.appendChild(t),t.onload=n.resolver,t.onerror=n.rejector,[2,n.promise])})})},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(7)),a=n(12),u=o(n(11)),c=n(11),l=n(19),d=o(n(31)),f=n(31),p=o(n(6)),h=n(16),g=n(30),v=n(15),b=n(3),m=o(n(10)),w=o(n(8)),S=o(n(0)),y=o(n(9)),k=n(29),P=n(22),_=n(13),O=n(18),E=o(n(2)),I=n(1),x=o(n(35)),W=function(){function e(e,t){this.context=e,this.config=t}return e.isSafari=function(){return s.default.safari},e.prototype.subscribe=function(t){return r(this,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:switch(n=S.default.getWindowEnv()){case b.WindowEnvironmentKind.CustomIframe:case b.WindowEnvironmentKind.Unknown:case b.WindowEnvironmentKind.OneSignalProxyFrame:throw new a.InvalidStateError(a.InvalidStateReason.UnsupportedEnvironment)}switch(n){case b.WindowEnvironmentKind.ServiceWorker:return[3,1];case b.WindowEnvironmentKind.Host:case b.WindowEnvironmentKind.OneSignalSubscriptionModal:case b.WindowEnvironmentKind.OneSignalSubscriptionPopup:return[3,3]}return[3,9];case 1:return[4,this.subscribeFcmFromWorker(t)];case 2:return r=i.sent(),[3,9];case 3:return[4,OneSignal.privateGetNotificationPermission()];case 4:if(i.sent()===h.NotificationPermission.Denied)throw new u.default(c.PushPermissionNotGrantedErrorReason.Blocked);return e.isSafari()?[4,this.subscribeSafari()]:[3,6];case 5:return r=i.sent(),[3,8];case 6:return[4,this.subscribeFcmFromPage(t)];case 7:r=i.sent(),i.label=8;case 8:return[3,9];case 9:return[2,r]}})})},e.prototype.registerSubscription=function(t,n){return r(this,void 0,void 0,function(){var r,o,s,a,u;return i(this,function(i){switch(i.label){case 0:return t&&(t=g.RawPushSubscription.deserialize(t)),(r=P.PushDeviceRecord.createFromPushSubscription(this.config.appId,t,n)).appId=this.config.appId,[4,this.isAlreadyRegisteredWithOneSignal()];case 1:return i.sent()?[4,w.default.getSubscription()]:[3,6];case 2:return s=i.sent().deviceId,t&&!t.isNewSubscription()?[3,4]:[4,m.default.updateUserSession(s,r)];case 3:return o=i.sent(),E.default.info("Updated the subscriber's OneSignal session:",r),[3,5];case 4:o=s,E.default.debug("The existing push subscription was resubscribed, but not registering with OneSignal because the new subscription is identical."),i.label=5;case 5:return[3,8];case 6:return[4,m.default.createUser(r)];case 7:a=i.sent(),o=a,E.default.info("Subscribed to web push and registered with OneSignal:",r),i.label=8;case 8:return[4,this.associateSubscriptionWithEmail(o)];case 9:return i.sent(),[4,w.default.getSubscription()];case 10:return(u=i.sent()).deviceId=o,u.optedOut=!1,t?e.isSafari()?u.subscriptionToken=t.safariDeviceToken:u.subscriptionToken=t.w3cEndpoint?t.w3cEndpoint.toString():null:u.subscriptionToken=null,[4,w.default.setSubscription(u)];case 11:return i.sent(),S.default.getWindowEnv()!==b.WindowEnvironmentKind.ServiceWorker&&p.default.trigger(OneSignal.EVENTS.REGISTERED),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),[2,u]}})})},e.requestPresubscribeNotificationPermission=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,e.requestNotificationPermission()];case 1:return[2,t.sent()]}})})},e.prototype.unsubscribe=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:if(0!==e)return[3,1];throw new y.default;case 1:return 1!==e?[3,7]:S.default.getWindowEnv()!==b.WindowEnvironmentKind.ServiceWorker?[3,5]:[4,w.default.getSubscription()];case 2:return t=n.sent().deviceId,[4,m.default.updatePlayer(this.context.appConfig.appId,t,{notification_types:v.SubscriptionStateKind.MutedByApi})];case 3:return n.sent(),[4,w.default.put("Options",{key:"optedOut",value:!0})];case 4:return n.sent(),[3,6];case 5:throw new y.default;case 6:return[3,8];case 7:throw new y.default;case 8:return[2]}})})},e.requestNotificationPermission=function(){return new Promise(function(e){return window.Notification.requestPermission(e)})},e.prototype.associateSubscriptionWithEmail=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return[4,w.default.getEmailProfile()];case 1:return(t=n.sent()).emailId?[4,m.default.updatePlayer(this.config.appId,e,{parent_player_id:t.emailId,email:t.emailAddress})]:[2];case 2:return n.sent(),[2]}})})},e.prototype.isAlreadyRegisteredWithOneSignal=function(){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,w.default.getSubscription()];case 1:return[2,!!e.sent().deviceId]}})})},e.prototype.subscribeSafariPromptPermission=function(){var e=this;return new Promise(function(t){window.safari.pushNotification.requestPermission(S.default.getOneSignalApiUrl().toString()+"/safari",e.config.safariWebId,{app_id:e.config.appId},function(e){e.deviceToken?t(e.deviceToken.toLowerCase()):t(null)})})},e.prototype.subscribeSafari=function(){return r(this,void 0,void 0,function(){var e,t,n;return i(this,function(r){switch(r.label){case 0:if(e=new g.RawPushSubscription,!this.config.safariWebId)throw new l.SdkInitError(l.SdkInitErrorKind.MissingSafariWebId);return t=window.safari.pushNotification.permission(this.config.safariWebId).deviceToken,e.existingSafariDeviceToken=t,t||p.default.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED),[4,this.subscribeSafariPromptPermission()];case 1:if(n=r.sent(),I.triggerNotificationPermissionChanged(),!n)throw new d.default(f.SubscriptionErrorReason.InvalidSafariSetup);return e.setFromSafariSubscription(n),[2,e]}})})},e.prototype.subscribeFcmFromPage=function(t){return r(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){switch(i.label){case 0:return S.default.getWindowEnv()===b.WindowEnvironmentKind.ServiceWorker||window.Notification.permission!==h.NotificationPermission.Default?[3,5]:[4,p.default.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED)];case 1:return i.sent(),[4,e.requestPresubscribeNotificationPermission()];case 2:return(n=i.sent())!==h.NotificationPermission.Default?[3,4]:[4,I.triggerNotificationPermissionChanged(!0)];case 3:i.sent(),i.label=4;case 4:switch(n){case h.NotificationPermission.Default:throw E.default.debug("Exiting subscription and not registering worker because the permission was dismissed."),OneSignal._sessionInitAlreadyRunning=!1,OneSignal._isRegisteringForPush=!1,new u.default(c.PushPermissionNotGrantedErrorReason.Dismissed);case h.NotificationPermission.Denied:throw E.default.debug("Exiting subscription and not registering worker because the permission was blocked."),OneSignal._sessionInitAlreadyRunning=!1,OneSignal._isRegisteringForPush=!1,new u.default(c.PushPermissionNotGrantedErrorReason.Blocked)}i.label=5;case 5:return[4,this.context.serviceWorkerManager.shouldInstallWorker()];case 6:if(!i.sent())return[3,14];i.label=7;case 7:return i.trys.push([7,9,,14]),[4,this.context.serviceWorkerManager.installWorker()];case 8:return i.sent(),[3,14];case 9:return(r=i.sent())instanceof x.default?403!==r.status?[3,11]:[4,this.context.subscriptionManager.registerFailedSubscription(v.SubscriptionStateKind.ServiceWorkerStatus403,this.context)]:[3,13];case 10:return i.sent(),[3,13];case 11:return 404!==r.status?[3,13]:[4,this.context.subscriptionManager.registerFailedSubscription(v.SubscriptionStateKind.ServiceWorkerStatus404,this.context)];case 12:i.sent(),i.label=13;case 13:throw r;case 14:return E.default.debug("Waiting for the service worker to activate..."),[4,navigator.serviceWorker.ready];case 15:return o=i.sent(),E.default.debug("Service worker is ready to continue subscribing."),[4,this.subscribeFcmVapidOrLegacyKey(o.pushManager,t)];case 16:return[2,i.sent()]}})})},e.prototype.subscribeFcmFromWorker=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:if(!self.registration.active&&!s.default.firefox)throw new a.InvalidStateError(a.InvalidStateReason.ServiceWorkerNotActivated);return[4,self.registration.pushManager.permissionState({userVisibleOnly:!0})];case 1:if("denied"===(t=n.sent()))throw new u.default(c.PushPermissionNotGrantedErrorReason.Blocked);if("prompt"===t)throw new u.default(c.PushPermissionNotGrantedErrorReason.Default);return[4,this.subscribeFcmVapidOrLegacyKey(self.registration.pushManager,e)];case 2:return[2,n.sent()]}})})},e.prototype.getVapidKeyForBrowser=function(){var e=void 0;return(e=s.default.firefox?this.config.onesignalVapidPublicKey:this.config.vapidPublicKey)?k.base64ToUint8Array(e).buffer:void 0},e.prototype.subscribeFcmVapidOrLegacyKey=function(e,t){return r(this,void 0,void 0,function(){var n,r,o,s,a,u;return i(this,function(i){switch(i.label){case 0:return n={userVisibleOnly:!0,applicationServerKey:this.getVapidKeyForBrowser()?this.getVapidKeyForBrowser():void 0},[4,e.getSubscription()];case 1:switch(o=i.sent(),s=!o,t){case 0:return[3,2];case 1:return[3,6]}return[3,9];case 2:return o&&o.options?(E.default.debug("[Subscription Manager] An existing push subscription exists and options is not null. Using existing options to resubscribe."),n=o.options,s=!1,[3,5]):[3,3];case 3:return!o||o.options?[3,5]:(E.default.debug("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),[4,o.unsubscribe()]);case 4:i.sent(),s=!1,i.label=5;case 5:return[3,9];case 6:return o?(E.default.debug("[Subscription Manager] Unsubscribing existing push subscription."),[4,o.unsubscribe()]):[3,8];case 7:i.sent(),i.label=8;case 8:return s=!0,[3,9];case 9:return E.default.debug("[Subscription Manager] Subscribing to web push with these options:",n),[4,e.subscribe(n)];case 10:return r=i.sent(),s?[4,w.default.getSubscription()]:[3,13];case 11:return(a=i.sent()).createdAt=(new Date).getTime(),a.expirationTime=r.expirationTime,[4,w.default.setSubscription(a)];case 12:i.sent(),i.label=13;case 13:return u=g.RawPushSubscription.setFromW3cSubscription(r),o&&(u.existingW3cPushSubscription=g.RawPushSubscription.setFromW3cSubscription(o)),[2,u]}})})},e.prototype.isSubscriptionExpiring=function(){return r(this,void 0,void 0,function(){var e,t,n,r;return i(this,function(i){switch(i.label){case 0:return[4,S.default.getIntegration()];case 1:switch(e=i.sent(),t=S.default.getWindowEnv(),e){case O.IntegrationKind.Secure:return[3,2];case O.IntegrationKind.SecureProxy:return[3,4];case O.IntegrationKind.InsecureProxy:return[3,10]}return[3,12];case 2:return[4,this.isSubscriptionExpiringForSecureIntegration()];case 3:return[2,i.sent()];case 4:if(t!==b.WindowEnvironmentKind.Host)return[3,8];if(n=OneSignal.proxyFrameHost)return[3,5];throw new a.InvalidStateError(a.InvalidStateReason.NoProxyFrame);case 5:return[4,n.runCommand(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE)];case 6:return[2,i.sent()];case 7:return[3,10];case 8:return[4,this.isSubscriptionExpiringForSecureIntegration()];case 9:return[2,i.sent()];case 10:return[4,w.default.getSubscription()];case 11:return(r=i.sent().expirationTime)?[2,(new Date).getTime()>=r]:[2,!1];case 12:return[2]}})})},e.prototype.isSubscriptionExpiringForSecureIntegration=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this.context.serviceWorkerManager.getActiveState()];case 1:return(e=i.sent())!==_.ServiceWorkerActiveState.WorkerA&&e!==_.ServiceWorkerActiveState.WorkerB?[2,!1]:[4,_.ServiceWorkerManager.getRegistration()];case 2:return(t=i.sent())&&t.pushManager?[4,t.pushManager.getSubscription()]:[2,!1];case 3:return(n=i.sent())&&n.expirationTime?[4,w.default.getSubscription()]:[2,!1];case 4:return(r=i.sent().createdAt)||(o=31536e6,r=(new Date).getTime()+o),s=r+(n.expirationTime-r)/2,[2,n.expirationTime&&((new Date).getTime()>=n.expirationTime||(new Date).getTime()>=s)]}})})},e.prototype.getSubscriptionState=function(){return r(this,void 0,void 0,function(){var t,n,r,o;return i(this,function(i){switch(i.label){case 0:if(e.isSafari())return[2,this.getSubscriptionStateForSecure()];switch(t=S.default.getWindowEnv(),t){case b.WindowEnvironmentKind.ServiceWorker:return[3,1]}return[3,4];case 1:return[4,self.registration.pushManager.getSubscription()];case 2:return n=i.sent(),[4,w.default.getSubscription()];case 3:return r=i.sent().optedOut,[2,{subscribed:!!n,optedOut:r}];case 4:return[4,S.default.getIntegration()];case 5:switch(o=i.sent(),o){case O.IntegrationKind.Secure:return[3,6];case O.IntegrationKind.SecureProxy:return[3,7];case O.IntegrationKind.InsecureProxy:return[3,11]}return[3,13];case 6:return[2,this.getSubscriptionStateForSecure()];case 7:switch(t){case b.WindowEnvironmentKind.OneSignalProxyFrame:case b.WindowEnvironmentKind.OneSignalSubscriptionPopup:case b.WindowEnvironmentKind.OneSignalSubscriptionModal:return[3,8]}return[3,9];case 8:return[2,this.getSubscriptionStateForSecure()];case 9:return[4,OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE)];case 10:return[2,i.sent()];case 11:return[4,this.getSubscriptionStateForInsecure()];case 12:return[2,i.sent()];case 13:throw new a.InvalidStateError(a.InvalidStateReason.UnsupportedEnvironment)}})})},e.prototype.getSubscriptionStateForSecure=function(){return r(this,void 0,void 0,function(){var t,n,r,o,s,a,u,c,l;return i(this,function(i){switch(i.label){case 0:return[4,w.default.getSubscription()];case 1:return t=i.sent(),n=t.deviceId,t.subscriptionToken,r=t.optedOut,e.isSafari()?(o=window.safari.pushNotification.permission(this.config.safariWebId),[2,{subscribed:!("granted"!==o.permission||!o.deviceToken||!n),optedOut:r}]):[4,this.context.serviceWorkerManager.getActiveState()];case 2:return s=i.sent(),[4,_.ServiceWorkerManager.getRegistration()];case 3:return a=i.sent(),[4,this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId)];case 4:return u=i.sent(),c=s===_.ServiceWorkerActiveState.WorkerA||s===_.ServiceWorkerActiveState.WorkerB,a?[4,a.pushManager.getSubscription()]:[2,{subscribed:!1,optedOut:r}];case 5:return l=i.sent(),[2,{subscribed:!!(l&&n&&u===h.NotificationPermission.Granted&&c),optedOut:r}]}})})},e.prototype.getSubscriptionStateForInsecure=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,w.default.getSubscription()];case 1:return e=i.sent(),t=e.deviceId,n=e.subscriptionToken,r=e.optedOut,[4,this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId)];case 2:return o=i.sent(),[2,{subscribed:!(!t||!n||o!==h.NotificationPermission.Granted),optedOut:r}]}})})},e.prototype.registerFailedSubscription=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(n){return t.sessionManager.isFirstPageView()&&(t.subscriptionManager.registerSubscription(new g.RawPushSubscription,e),t.sessionManager.incrementPageViewCount()),[2]})})},e}();t.SubscriptionManager=W},,function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.DevicePlatformKind||(t.DevicePlatformKind={})).Mobile="mobile",r.Tablet="tablet",r.Desktop="desktop"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,a=o(n(4));(s=t.OneSignalApiErrorKind||(t.OneSignalApiErrorKind={}))[s.MissingAppId=0]="MissingAppId";var u=function(e){function n(r){var i=this;switch(r){case t.OneSignalApiErrorKind.MissingAppId:i=e.call(this,"The API call is missing an app ID.")||this}return Object.setPrototypeOf(i,n.prototype),i}return i(n,e),n}(a.default);t.OneSignalApiError=u},function(e,t){e.exports=function(e,t,i){"function"==typeof t&&(i=t,t={});t||(t={});var o,s,a=t.prefix||"__jp",u=t.name||a+n++,c=t.param||"callback",l=null!=t.timeout?t.timeout:6e4,d=encodeURIComponent,f=document.getElementsByTagName("script")[0]||document.head;l&&(s=setTimeout(function(){p(),i&&i(new Error("Timeout"))},l));function p(){o.parentNode&&o.parentNode.removeChild(o),window[u]=r,s&&clearTimeout(s)}return window[u]=function(e){p(),i&&i(null,e)},e=(e+=(~e.indexOf("?")?"&":"?")+c+"="+d(u)).replace("?&","?"),(o=document.createElement("script")).src=e,f.parentNode.insertBefore(o,f),function(){window[u]&&p()}};var n=0;function r(){}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.ServiceWorkerState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.AppState=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var TimeoutError=function(e){function TimeoutError(t){void 0===t&&(t="The asynchronous operation has timed out.");var n=e.call(this,t)||this;return n.message=t,Object.setPrototypeOf(n,TimeoutError.prototype),n}return i(TimeoutError,e),TimeoutError}(o(n(4)).default);t.default=TimeoutError},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(48);self.OneSignal=r.ServiceWorker}]);
//# sourceMappingURL=OneSignalSDKWorker.js.map